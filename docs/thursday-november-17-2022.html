<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Thursday November 17, 2022 | GEO5156: Quantitative Geography</title>
  <meta name="description" content="Thursday November 17, 2022 | GEO5156: Quantitative Geography" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Thursday November 17, 2022 | GEO5156: Quantitative Geography" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jelsner/QG-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Thursday November 17, 2022 | GEO5156: Quantitative Geography" />
  
  
  

<meta name="author" content="James B. Elsner" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tuesday-november-15-2022.html"/>
<link rel="next" href="tuesday-november-22-2022.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quantitative Geography</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html"><i class="fa fa-check"></i>Syllabus</a>
<ul>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#geo5165c-quantitative-geography"><i class="fa fa-check"></i>GEO5165C: Quantitative Geography</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#contact-information"><i class="fa fa-check"></i>Contact information</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#course-description-and-expected-learning-outcomes"><i class="fa fa-check"></i>Course description and expected learning outcomes</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#grades-and-ethics"><i class="fa fa-check"></i>Grades and ethics</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#schedule-subject-to-change-with-notice"><i class="fa fa-check"></i>Schedule (subject to change with notice)</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#deeper-dives"><i class="fa fa-check"></i>Deeper dives</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html"><i class="fa fa-check"></i>Tuesday, August 23, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#what-is-this-course"><i class="fa fa-check"></i>What is this course?</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#where-are-the-materials-for-this-course"><i class="fa fa-check"></i>Where are the materials for this course?</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#get-the-syllabus"><i class="fa fa-check"></i>Get the syllabus</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#getting-setup"><i class="fa fa-check"></i>Getting setup</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#getting-to-know-rstudios-integrated-development-environment-ide"><i class="fa fa-check"></i>Getting to know RStudio’s integrated development environment (IDE)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html"><i class="fa fa-check"></i>Thursday, August 25, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#data-science"><i class="fa fa-check"></i>Data science</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#structure-of-markdown-files"><i class="fa fa-check"></i>Structure of markdown files</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#how-to-make-a-plot"><i class="fa fa-check"></i>How to make a plot</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#getting-started-using-r"><i class="fa fa-check"></i>Getting started using R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html"><i class="fa fa-check"></i>Tuesday, August 30, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#graphing-examples"><i class="fa fa-check"></i>Graphing examples</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#introduction-to-working-with-base-r"><i class="fa fa-check"></i>Introduction to working with base R</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#data-as-vectors"><i class="fa fa-check"></i>Data as vectors</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html"><i class="fa fa-check"></i>Thursday, September 1, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#statistical-summaries-of-data"><i class="fa fa-check"></i>Statistical summaries of data</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#structured-data"><i class="fa fa-check"></i>Structured data</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#tables"><i class="fa fa-check"></i>Tables</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#assignment-1"><i class="fa fa-check"></i>Assignment #1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html"><i class="fa fa-check"></i>Tuesday, September 6, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#getting-data-into-r"><i class="fa fa-check"></i>Getting data into R</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#data-frames"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#piping-your-commands"><i class="fa fa-check"></i>Piping your commands</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html"><i class="fa fa-check"></i>Thursday, September 8, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#data-transformation-with-dplyr"><i class="fa fa-check"></i>Data transformation with {dplyr}</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#from-data-import-to-final-plot"><i class="fa fa-check"></i>From data import to final plot</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html"><i class="fa fa-check"></i>Tuesday, September 13, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#data-visualization"><i class="fa fa-check"></i>Data visualization</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html"><i class="fa fa-check"></i>Tuesday, September 20, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html#comparing-distributions"><i class="fa fa-check"></i>Comparing distributions</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html#visualizing-uncertainty"><i class="fa fa-check"></i>Visualizing uncertainty</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html#simple-feature-data-frames"><i class="fa fa-check"></i>Simple feature data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-20-2022.html"><a href="tuesday-september-20-2022.html#making-a-boundary-map"><i class="fa fa-check"></i>Making a boundary map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html"><i class="fa fa-check"></i>Thursday, September 22, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#adding-data-to-boundary-maps"><i class="fa fa-check"></i>Adding data to boundary maps</a></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#changing-projections"><i class="fa fa-check"></i>Changing projections</a></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#mapping-using-functions-from-tmap"><i class="fa fa-check"></i>Mapping using functions from tmap</a></li>
<li class="chapter" data-level="" data-path="thursday-september-22-2022.html"><a href="thursday-september-22-2022.html#making-an-interactive-map"><i class="fa fa-check"></i>Making an interactive map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-october-4-2022.html"><a href="tuesday-october-4-2022.html"><i class="fa fa-check"></i>Tuesday, October 4, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-october-4-2022.html"><a href="tuesday-october-4-2022.html#extended-mapping-example-tornado-frequency"><i class="fa fa-check"></i>Extended mapping example: tornado frequency</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-4-2022.html"><a href="tuesday-october-4-2022.html#geo-computation-on-simple-feature-data-frames"><i class="fa fa-check"></i>Geo-computation on simple feature data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-4-2022.html"><a href="tuesday-october-4-2022.html#making-raster-maps"><i class="fa fa-check"></i>Making raster maps</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-4-2022.html"><a href="tuesday-october-4-2022.html#spatial-density-maps"><i class="fa fa-check"></i>Spatial density maps</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-4-2022.html"><a href="tuesday-october-4-2022.html#assignment-3"><i class="fa fa-check"></i>Assignment #3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-29-2022.html"><a href="thursday-september-29-2022.html"><i class="fa fa-check"></i>Thursday, September 29, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-29-2022.html"><a href="thursday-september-29-2022.html#one-sample-test-for-the-value-of-the-population-mean"><i class="fa fa-check"></i>One-sample test for the value of the population mean</a></li>
<li class="chapter" data-level="" data-path="thursday-september-29-2022.html"><a href="thursday-september-29-2022.html#graphical-inference"><i class="fa fa-check"></i>Graphical inference</a></li>
<li class="chapter" data-level="" data-path="thursday-september-29-2022.html"><a href="thursday-september-29-2022.html#two-sample-test-for-a-difference-in-population-means"><i class="fa fa-check"></i>Two-sample test for a difference in population means</a></li>
<li class="chapter" data-level="" data-path="thursday-september-29-2022.html"><a href="thursday-september-29-2022.html#a-non-parameteric-test-for-difference-in-population-means"><i class="fa fa-check"></i>A non-parameteric test for difference in population means</a></li>
<li class="chapter" data-level="" data-path="thursday-september-29-2022.html"><a href="thursday-september-29-2022.html#paired-observations"><i class="fa fa-check"></i>Paired observations</a></li>
<li class="chapter" data-level="" data-path="thursday-september-29-2022.html"><a href="thursday-september-29-2022.html#chi-squared-test-for-independence"><i class="fa fa-check"></i>Chi-squared test for independence</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-october-11-2022.html"><a href="tuesday-october-11-2022.html"><i class="fa fa-check"></i>Tuesday, October 11, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-october-11-2022.html"><a href="tuesday-october-11-2022.html#distributions-as-lego-bricks"><i class="fa fa-check"></i>Distributions as Lego bricks</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-11-2022.html"><a href="tuesday-october-11-2022.html#bayesian-computation"><i class="fa fa-check"></i>Bayesian computation</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-11-2022.html"><a href="tuesday-october-11-2022.html#real-world-example"><i class="fa fa-check"></i>Real world example</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-11-2022.html"><a href="tuesday-october-11-2022.html#why-use-bayesian-models"><i class="fa fa-check"></i>Why use Bayesian models?</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-october-13-2022.html"><a href="thursday-october-13-2022.html"><i class="fa fa-check"></i>Thursday, October 13, 2022</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-18-2022.html"><a href="tuesday-october-18-2022.html"><i class="fa fa-check"></i>Tuesday, October 18, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-october-18-2022.html"><a href="tuesday-october-18-2022.html#linear-regression-a-t-test-by-another-name"><i class="fa fa-check"></i>Linear regression: A t test by another name</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-18-2022.html"><a href="tuesday-october-18-2022.html#motivation-for-the-regression-model"><i class="fa fa-check"></i>Motivation for the regression model</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-18-2022.html"><a href="tuesday-october-18-2022.html#making-predictions-with-the-regression-model"><i class="fa fa-check"></i>Making predictions with the regression model</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-18-2022.html"><a href="tuesday-october-18-2022.html#uncertainty-about-the-regression-model-coefficients"><i class="fa fa-check"></i>Uncertainty about the regression model coefficients</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-18-2022.html"><a href="tuesday-october-18-2022.html#bootstrapping-the-uncertainty"><i class="fa fa-check"></i>Bootstrapping the uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html"><i class="fa fa-check"></i>Thursday, October 20, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#predictive-uncertainty"><i class="fa fa-check"></i>Predictive uncertainty</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#model-adequacy"><i class="fa fa-check"></i>Model adequacy</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#regression-examples"><i class="fa fa-check"></i>Regression examples</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#outliers"><i class="fa fa-check"></i>Outliers</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html"><i class="fa fa-check"></i>Tuesday, October 25, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#simpsons-paradox"><i class="fa fa-check"></i>Simpson’s paradox</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#multiple-variable-regression"><i class="fa fa-check"></i>Multiple variable regression</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#fitting-a-multiple-variable-regression-model"><i class="fa fa-check"></i>Fitting a multiple variable regression model</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#should-you-remove-a-variable-from-your-model"><i class="fa fa-check"></i>Should you remove a variable from your model?</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#checking-the-model-assumptions"><i class="fa fa-check"></i>Checking the model assumptions</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#using-the-model-to-make-predictions"><i class="fa fa-check"></i>Using the model to make predictions</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#collinearity-and-what-to-do-about-it"><i class="fa fa-check"></i>Collinearity and what to do about it</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#how-to-include-and-interpret-interactions-terms"><i class="fa fa-check"></i>How to include and interpret interactions terms</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html"><i class="fa fa-check"></i>Tuesday, November 1, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#removing-variables-from-a-regression-model"><i class="fa fa-check"></i>Removing variables from a regression model</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#automatic-selection-of-variables"><i class="fa fa-check"></i>Automatic selection of variables</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#transforming-the-response-variable"><i class="fa fa-check"></i>Transforming the response variable</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#fitting-a-regression-tree-model"><i class="fa fa-check"></i>Fitting a regression tree model</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html"><i class="fa fa-check"></i>Tuesday, November 8, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#predictive-uncertainty-with-regression-trees"><i class="fa fa-check"></i>Predictive uncertainty with regression trees</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#the-random-forest-algorithm"><i class="fa fa-check"></i>The random forest algorithm</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#cross-validation"><i class="fa fa-check"></i>Cross validation</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#classification-trees"><i class="fa fa-check"></i>Classification trees</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html"><i class="fa fa-check"></i>Tuesday, November 15, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html#binary-outcomes-and-probabilities"><i class="fa fa-check"></i>Binary outcomes and probabilities</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html#logistic-regression"><i class="fa fa-check"></i>Logistic regression</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html"><i class="fa fa-check"></i>Thursday November 17, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html#defining-spatial-neighborhoods-and-spatial-weights"><i class="fa fa-check"></i>Defining spatial neighborhoods and spatial weights</a></li>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html#computing-autocorrelation"><i class="fa fa-check"></i>Computing autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html#spatial-lag-and-its-relation-to-autocorrelation"><i class="fa fa-check"></i>Spatial lag and its relation to autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html#other-neighbor-definitions"><i class="fa fa-check"></i>Other neighbor definitions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-22-2022.html"><a href="tuesday-november-22-2022.html"><i class="fa fa-check"></i>Tuesday November 22, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-22-2022.html"><a href="tuesday-november-22-2022.html#assessing-the-statistical-significance-of-autocorrelation"><i class="fa fa-check"></i>Assessing the statistical significance of autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-22-2022.html"><a href="tuesday-november-22-2022.html#bivariate-spatial-autocorrelation"><i class="fa fa-check"></i>Bivariate spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-22-2022.html"><a href="tuesday-november-22-2022.html#local-indicators-of-spatial-autocorrelation"><i class="fa fa-check"></i>Local indicators of spatial autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-29-2022.html"><a href="tuesday-november-29-2022.html"><i class="fa fa-check"></i>Tuesday November 29, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-29-2022.html"><a href="tuesday-november-29-2022.html#estimating-spatial-autocorrelation-in-model-residuals"><i class="fa fa-check"></i>Estimating spatial autocorrelation in model residuals</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-29-2022.html"><a href="tuesday-november-29-2022.html#choosing-a-spatial-regression-model"><i class="fa fa-check"></i>Choosing a spatial regression model</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-29-2022.html"><a href="tuesday-november-29-2022.html#fitting-and-interpreting-spatial-regression-models"><i class="fa fa-check"></i>Fitting and interpreting spatial regression models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-december-1-2022.html"><a href="thursday-december-1-2022.html"><i class="fa fa-check"></i>Thursday December 1, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-december-1-2022.html"><a href="thursday-december-1-2022.html#fitting-and-interpreting-geographic-regression"><i class="fa fa-check"></i>Fitting and interpreting geographic regression</a></li>
<li class="chapter" data-level="" data-path="thursday-december-1-2022.html"><a href="thursday-december-1-2022.html#mapping-incidence-and-risk-with-a-spatial-regression-model"><i class="fa fa-check"></i>Mapping incidence and risk with a spatial regression model</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEO5156: Quantitative Geography</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="thursday-november-17-2022" class="section level1 unnumbered hasAnchor">
<h1>Thursday November 17, 2022<a href="thursday-november-17-2022.html#thursday-november-17-2022" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><em>Announcement</em> Starting today all lessons will be via Zoom. I will start at 3:05 p.m. and record it so you can watch it live or watch it later at your convenience.</p>
<ul>
<li>Defining spatial neighborhoods and spatial weights</li>
<li>Computing spatial autocorrelation</li>
<li>Spatial lag and its relation to autocorrelation</li>
<li>Other neighbor definitions</li>
</ul>
<div id="defining-spatial-neighborhoods-and-spatial-weights" class="section level2 unnumbered hasAnchor">
<h2>Defining spatial neighborhoods and spatial weights<a href="thursday-november-17-2022.html#defining-spatial-neighborhoods-and-spatial-weights" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Autocorrelation plays a central role in spatial statistics. It quantifies the degree to which things nearby tend to cluster.</p>
<p>Things include values of variables (attributes) aggregated to polygons (or raster cells) as well as the spatial locations of objects. How autocorrelation gets estimated depends on the geometry of the spatial data.</p>
<p>Things tend to cluster because of</p>
<ul>
<li><p>Association: whatever causes an attribute to have a certain value in one area causes the same attribute to have a similar value in areas nearby. Crime rates in nearby neighborhoods might tend to cluster due to similar factors.</p></li>
<li><p>Causality: something within a given area directly influences outcomes within nearby areas. Non-infectious diseases (e.g., lung cancer) have similar rates in neighborhoods close to an oil refinery.</p></li>
<li><p>Interaction: the movement of people, goods or information creates relationships between areas. COVID spreads through areas through the movement of people.</p></li>
</ul>
<p>Spatial statistics focuses on quantifying autocorrelation but it is silent about physical causes. Understanding the reason for autocorrelation in your data is important for inference because the causal mechanism might be confounded by its presence. Divorce rates tend to cluster in the South, but so do Waffle Houses. Understanding causation requires domain specific knowledge.</p>
<p>When a variable’s values are aggregated (summed or averaged) to regions, autocorrelation is quantified by calculating how similar a value in region <span class="math inline">\(i\)</span> is to the value in region <span class="math inline">\(j\)</span> and weighting this similarity by how ‘close’ region <span class="math inline">\(i\)</span> is to region <span class="math inline">\(j\)</span>. Closer regions are given greater weight.</p>
<p>High similarities with high weight (similar values close together) yield high values of spatial autocorrelation. Low similarities with high weight (dissimilar values close together) yield low values of spatial autocorrelation.</p>
<p>Let <span class="math inline">\(\hbox{sim}_{ij}\)</span> denote the similarity between values <span class="math inline">\(Y_i\)</span> and <span class="math inline">\(Y_j\)</span>, and let <span class="math inline">\(w_{ij}\)</span> denote a set of weights describing the ‘distance’ between regions <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, for <span class="math inline">\(i\)</span>, <span class="math inline">\(j\)</span> = 1, …, <span class="math inline">\(N\)</span>.</p>
<p>A general spatial autocorrelation index (SAI) is given by
<span class="math display">\[
\hbox{SAI} = \frac{\sum_{i,j=1}^N w_{ij}\hbox{sim}_{ij}}{\sum_{i,j=1}^N w_{ij}}
\]</span>
which represents a weighted similarity between regions. The set of weights (<span class="math inline">\(w_{ij}\)</span>) is called a spatial weights matrix. The spatial weights matrix (1) defines the neighbors for each region and (2) defines the strength of each association.</p>
<p>For cells in a raster under the <em>rook-contiguity</em> criterion, <span class="math inline">\(w_{ij}\)</span> = 1 if cell <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> share more than one boundary point, and 0 if not. For cells in a raster under the <em>queen-contiguity</em> criterion, <span class="math inline">\(w_{ij}\)</span> = 1 if cell <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> share at least one point. <a href="figures/contiguity.png">Rook (left) and queen contiguity illustrated using a checkerboard</a>.</p>
<p>In these cases <span class="math inline">\(w_{ij}\)</span> = <span class="math inline">\(w_{ji}\)</span>. Also, a cell is not a neighbor of itself so <span class="math inline">\(w_{ii}\)</span> = 0.</p>
<p>Alternatively you can define center locations from a set of polygon regions and let <span class="math inline">\(w_{ij}\)</span> = 1 if the center of region <span class="math inline">\(i\)</span> is near the center of region <span class="math inline">\(j\)</span> and 0 otherwise. In this case you need to decide on the number of nearest neighbors.</p>
<p>You can also define neighbors by distance. For example, if <span class="math inline">\(d_{ij}\)</span> is the distance between centers <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, you can let <span class="math inline">\(w_{ij}\)</span> = 1 if <span class="math inline">\(d_{ij}\)</span> &lt; <span class="math inline">\(\delta\)</span> and 0 otherwise.</p>
<p>Consider crime data at the tract level in the city of Columbus, Ohio. The tract polygons are planar projected with arbitrary spatial coordinates.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="thursday-november-17-2022.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;columbus&quot;</span> <span class="sc">%in%</span> <span class="fu">list.files</span>(<span class="st">&quot;data&quot;</span>)) {</span>
<span id="cb1-2"><a href="thursday-november-17-2022.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/columbus.zip&quot;</span>,</span>
<span id="cb1-3"><a href="thursday-november-17-2022.html#cb1-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;columbus.zip&quot;</span>))</span>
<span id="cb1-4"><a href="thursday-november-17-2022.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;columbus.zip&quot;</span>),</span>
<span id="cb1-5"><a href="thursday-november-17-2022.html#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb1-6"><a href="thursday-november-17-2022.html#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="thursday-november-17-2022.html#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="thursday-november-17-2022.html#cb1-8" aria-hidden="true" tabindex="-1"></a>( CC.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;columbus&quot;</span>),</span>
<span id="cb1-9"><a href="thursday-november-17-2022.html#cb1-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">layer =</span> <span class="st">&quot;columbus&quot;</span>) )</span></code></pre></div>
<pre><code>## Reading layer `columbus&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/QG-2022/data/columbus&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 49 features and 20 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245
## CRS:           NA</code></pre>
<pre><code>## Simple feature collection with 49 features and 20 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 5.874907 ymin: 10.78863 xmax: 11.28742 ymax: 14.74245
## CRS:           NA
## First 10 features:
##        AREA PERIMETER COLUMBUS_ COLUMBUS_I POLYID NEIG  HOVAL    INC     CRIME
## 1  0.309441  2.440629         2          5      1    5 80.467 19.531 15.725980
## 2  0.259329  2.236939         3          1      2    1 44.567 21.232 18.801754
## 3  0.192468  2.187547         4          6      3    6 26.350 15.956 30.626781
## 4  0.083841  1.427635         5          2      4    2 33.200  4.477 32.387760
## 5  0.488888  2.997133         6          7      5    7 23.225 11.252 50.731510
## 6  0.283079  2.335634         7          8      6    8 28.750 16.029 26.066658
## 7  0.257084  2.554577         8          4      7    4 75.000  8.438  0.178269
## 8  0.204954  2.139524         9          3      8    3 37.125 11.337 38.425858
## 9  0.500755  3.169707        10         18      9   18 52.600 17.586 30.515917
## 10 0.246689  2.087235        11         10     10   10 96.400 13.598 34.000835
##        OPEN    PLUMB DISCBD     X     Y NSA NSB EW CP THOUS NEIGNO
## 1  2.850747 0.217155   5.03 38.80 44.07   1   1  1  0  1000   1005
## 2  5.296720 0.320581   4.27 35.62 42.38   1   1  0  0  1000   1001
## 3  4.534649 0.374404   3.89 39.82 41.18   1   1  1  0  1000   1006
## 4  0.394427 1.186944   3.70 36.50 40.52   1   1  0  0  1000   1002
## 5  0.405664 0.624596   2.83 40.01 38.00   1   1  1  0  1000   1007
## 6  0.563075 0.254130   3.78 43.75 39.28   1   1  1  0  1000   1008
## 7  0.000000 2.402402   2.74 33.36 38.41   1   1  0  0  1000   1004
## 8  3.483478 2.739726   2.89 36.71 38.71   1   1  0  0  1000   1003
## 9  0.527488 0.890736   3.17 43.44 35.92   1   1  1  0  1000   1018
## 10 1.548348 0.557724   4.33 47.61 36.42   1   1  1  0  1000   1010
##                          geometry
## 1  POLYGON ((8.624129 14.23698...
## 2  POLYGON ((8.25279 14.23694,...
## 3  POLYGON ((8.653305 14.00809...
## 4  POLYGON ((8.459499 13.82035...
## 5  POLYGON ((8.685274 13.63952...
## 6  POLYGON ((9.401384 13.5504,...
## 7  POLYGON ((8.037741 13.60752...
## 8  POLYGON ((8.247527 13.58651...
## 9  POLYGON ((9.333297 13.27242...
## 10 POLYGON ((10.08251 13.03377...</code></pre>
<p>The simple feature data frame contains housing values (<code>HOVAL</code>), income values (<code>INC</code>) and (<code>CRIME</code>) in census tracts across the city. Crime (<code>CRIME</code>) is residential burglaries and vehicle thefts per 1000 households. Income (<code>INC</code>) and housing values (<code>HOVAL</code>) are annual values with units of 1000 dollars.</p>
<p>Create a choropleth map of the crime rates (<code>CRIME</code>).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="thursday-november-17-2022.html#cb4-1" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(CC.sf) <span class="sc">+</span></span>
<span id="cb4-2"><a href="thursday-november-17-2022.html#cb4-2" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="at">col =</span> <span class="st">&quot;CRIME&quot;</span>,</span>
<span id="cb4-3"><a href="thursday-november-17-2022.html#cb4-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">title =</span> <span class="st">&quot;Burglary &amp; Vehicle Thefts</span><span class="sc">\n</span><span class="st">/1000 Households&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Currect projection of shape CC.sf unknown. Long-lat (WGS84) is assumed.</code></pre>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Note that the variable name CRIME must be in quotes.</p>
<p>Alternatively you create a choropleth map of the crime rates using <code>geom_sf()</code>. Here the variable name CRIME is without quotes.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="thursday-november-17-2022.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-2"><a href="thursday-november-17-2022.html#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="thursday-november-17-2022.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> CC.sf) <span class="sc">+</span> </span>
<span id="cb6-4"><a href="thursday-november-17-2022.html#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> CRIME)) <span class="sc">+</span></span>
<span id="cb6-5"><a href="thursday-november-17-2022.html#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Burglary &amp; Vehicle Thefts</span><span class="sc">\n</span><span class="st">/1000 Households&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="thursday-november-17-2022.html#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>High (and low) crime areas tend to be clustered.</p>
<p>Autocorrelation quantifies the amount of clustering. To compute the autocorrelation you first need to define the neighbors for each polygon.</p>
<p>You create a list of neighbors using the <code>spdep::poly2nb()</code> function from the {spdep} package. Functions in the {spdep} package support S3 and S4 spatial data objects.</p>
<p>The ‘nb’ in the function names stands for neighbor (list) object. The function builds the list from geometries based on contiguity. Neighbors must share a border. By default contiguity is defined as having at least one location along a border common. This is changed by using the argument <code>queen = FALSE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="thursday-november-17-2022.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(spdep)) <span class="fu">install.packages</span>(<span class="st">&quot;spdep&quot;</span>, <span class="at">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: spdep</code></pre>
<pre><code>## Loading required package: sp</code></pre>
<pre><code>## Loading required package: spData</code></pre>
<pre><code>## Loading required package: sf</code></pre>
<pre><code>## Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="thursday-november-17-2022.html#cb13-1" aria-hidden="true" tabindex="-1"></a>( nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(CC.sf) )</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 49 
## Number of nonzero links: 236 
## Percentage nonzero weights: 9.829238 
## Average number of links: 4.816327</code></pre>
<p>The output tells you there are 49 tracts (polygons). Each tract is bordered by at least one other tract. The average number of neighbors is 4.8. The total number of neighbors over all tracts is 236. This represents 9.8% of all possible connections (if every tract is a neighbor of itself and every other tract 49 * 49).</p>
<p>Note that this only works for spatial data frames. It will not work for a regular data frame where the spatial coordinates are defined as variables.</p>
<p>A graph of the tracts as nodes and neighbors as links is obtained with the <code>plot()</code> method. The arguments include the neighbor list object (here you assigned it the name <code>nbs</code>) and the location of the polygon centers, which are extracted from the simple feature data frame using the <code>sf::st_centroid()</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="thursday-november-17-2022.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(CC.sf<span class="sc">$</span>geometry)</span>
<span id="cb15-2"><a href="thursday-november-17-2022.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nbs, </span>
<span id="cb15-3"><a href="thursday-november-17-2022.html#cb15-3" aria-hidden="true" tabindex="-1"></a>     sf<span class="sc">::</span><span class="fu">st_centroid</span>(CC.sf<span class="sc">$</span>geometry),</span>
<span id="cb15-4"><a href="thursday-november-17-2022.html#cb15-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The graph is a network showing the contiguity pattern (adjacency or neighbor structure). Tracts close to the center of the city have more neighboring tracts and thus more links in the network.</p>
<p>The number of links per tract (node)–link distribution–is obtained with the <code>summary()</code> method.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="thursday-november-17-2022.html#cb16-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="thursday-november-17-2022.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 49 
## Number of nonzero links: 236 
## Percentage nonzero weights: 9.829238 
## Average number of links: 4.816327 
## Link number distribution:
## 
##  2  3  4  5  6  7  8  9 10 
##  5  9 12  5  9  3  4  1  1 
## 5 least connected regions:
## 1 6 42 46 47 with 2 links
## 1 most connected region:
## 20 with 10 links</code></pre>
<p>The list of neighboring tracts for the first two tracts.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="thursday-november-17-2022.html#cb18-1" aria-hidden="true" tabindex="-1"></a>nbs[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] 2 3</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="thursday-november-17-2022.html#cb20-1" aria-hidden="true" tabindex="-1"></a>nbs[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] 1 3 4</code></pre>
<p>The first tract has two neighbors that include tracts 2 and 3. The neighbor numbers are stored as an integer vector within the <code>nb</code> object. Tract 2 has three neighbors that include tracts 1, 3, and 4. Tract 5 has 8 neighbors and so on. The function <code>spdep::card()</code> tallies the number of neighbors by tract.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="thursday-november-17-2022.html#cb22-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">card</span>(nbs)</span></code></pre></div>
<pre><code>##  [1]  2  3  4  4  8  2  4  6  8  4  5  6  4  6  6  8  3  4  3 10  3  6  3  7  8
## [26]  6  4  9  7  5  3  4  4  4  7  5  6  6  3  5  3  2  6  5  4  2  2  4  3</code></pre>
<p>Tract 5 has 8 neighbors and so on.</p>
<p>The next step is to include weights to the neighbor list object indicating how ‘close’ each neighbor is. The function <code>spdep::nb2listw()</code> turns the neighbor list object into a spatial weights object. By default the weighting scheme gives each link the same weight equal to the multiplicative inverse of the number of neighbors.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="thursday-november-17-2022.html#cb24-1" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> nbs <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="thursday-november-17-2022.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">nb2listw</span>()</span>
<span id="cb24-3"><a href="thursday-november-17-2022.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="thursday-november-17-2022.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(wts)</span></code></pre></div>
<pre><code>## [1] &quot;listw&quot; &quot;nb&quot;</code></pre>
<p>This <code>wts</code> object is a list with two elements. The first element (<code>listw</code>) is the weights matrix and the second element (<code>nb</code>) is the neighbor list object.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="thursday-november-17-2022.html#cb26-1" aria-hidden="true" tabindex="-1"></a>wts <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="thursday-november-17-2022.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## Characteristics of weights list object:
## Neighbour list object:
## Number of regions: 49 
## Number of nonzero links: 236 
## Percentage nonzero weights: 9.829238 
## Average number of links: 4.816327 
## Link number distribution:
## 
##  2  3  4  5  6  7  8  9 10 
##  5  9 12  5  9  3  4  1  1 
## 5 least connected regions:
## 1 6 42 46 47 with 2 links
## 1 most connected region:
## 20 with 10 links
## 
## Weights style: W 
## Weights constants summary:
##    n   nn S0       S1       S2
## W 49 2401 49 22.75119 203.7091</code></pre>
<p>The network statistics are given along with information about the weights. The default weighting scheme assigns a weight to each neighbor equal to the inverse of the number of neighbors (<code>style = "W"</code>). For a tract with 5 neighbors each neighbor gets a weight of 1/5. The sum over all weights (<code>S0</code>) is the number of tracts.</p>
<p>To see the weights for the first two tracts type</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="thursday-november-17-2022.html#cb28-1" aria-hidden="true" tabindex="-1"></a>wts<span class="sc">$</span>weights[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.5 0.5
## 
## [[2]]
## [1] 0.3333333 0.3333333 0.3333333</code></pre>
<p>The object <code>weights</code> represents the weights matrix as a list. The full matrix has dimensions 49 x 49 but most of the entries are zero since for a given tract most tracts are not neighbors.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="thursday-november-17-2022.html#cb30-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="thursday-november-17-2022.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">nb2mat</span>() <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="thursday-november-17-2022.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##        [,1] [,2]      [,3]      [,4] [,5]  [,6] [,7]  [,8]  [,9] [,10] [,11]
## 1 0.0000000 0.50 0.5000000 0.0000000 0.00 0.000    0 0.000 0.000     0 0.000
## 2 0.3333333 0.00 0.3333333 0.3333333 0.00 0.000    0 0.000 0.000     0 0.000
## 3 0.2500000 0.25 0.0000000 0.2500000 0.25 0.000    0 0.000 0.000     0 0.000
## 4 0.0000000 0.25 0.2500000 0.0000000 0.25 0.000    0 0.250 0.000     0 0.000
## 5 0.0000000 0.00 0.1250000 0.1250000 0.00 0.125    0 0.125 0.125     0 0.125
## 6 0.0000000 0.00 0.0000000 0.0000000 0.50 0.000    0 0.000 0.500     0 0.000
##   [,12] [,13] [,14] [,15] [,16] [,17] [,18] [,19] [,20] [,21] [,22] [,23] [,24]
## 1     0     0     0 0.000 0.000     0     0     0     0     0     0     0     0
## 2     0     0     0 0.000 0.000     0     0     0     0     0     0     0     0
## 3     0     0     0 0.000 0.000     0     0     0     0     0     0     0     0
## 4     0     0     0 0.000 0.000     0     0     0     0     0     0     0     0
## 5     0     0     0 0.125 0.125     0     0     0     0     0     0     0     0
## 6     0     0     0 0.000 0.000     0     0     0     0     0     0     0     0
##   [,25] [,26] [,27] [,28] [,29] [,30] [,31] [,32] [,33] [,34] [,35] [,36] [,37]
## 1     0     0     0     0     0     0     0     0     0     0     0     0     0
## 2     0     0     0     0     0     0     0     0     0     0     0     0     0
## 3     0     0     0     0     0     0     0     0     0     0     0     0     0
## 4     0     0     0     0     0     0     0     0     0     0     0     0     0
## 5     0     0     0     0     0     0     0     0     0     0     0     0     0
## 6     0     0     0     0     0     0     0     0     0     0     0     0     0
##   [,38] [,39] [,40] [,41] [,42] [,43] [,44] [,45] [,46] [,47] [,48] [,49]
## 1     0     0     0     0     0     0     0     0     0     0     0     0
## 2     0     0     0     0     0     0     0     0     0     0     0     0
## 3     0     0     0     0     0     0     0     0     0     0     0     0
## 4     0     0     0     0     0     0     0     0     0     0     0     0
## 5     0     0     0     0     0     0     0     0     0     0     0     0
## 6     0     0     0     0     0     0     0     0     0     0     0     0</code></pre>
<p>To see the neighbors of the first two tracts type</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="thursday-november-17-2022.html#cb32-1" aria-hidden="true" tabindex="-1"></a>wts<span class="sc">$</span>neighbours[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [[1]]
## [1] 2 3
## 
## [[2]]
## [1] 1 3 4</code></pre>
<p>Tract 1 has two neighbors (tract 2 &amp; 3) so each are given a weight of 1/2. Tract 2 has three neighbors (tract 1, 3, &amp; 4) so each are given a weight of 1/3.</p>
<p>With the weights matrix saved as an object you are ready to compute a metric of spatial autocorrelation.</p>
<p>Caution: Neighbors defined by contiguity can leave some areas without any neighbors. Islands for example. By default the <code>spdep::nb2listw()</code> function assumes each area has at least one neighbor. If this is not the case you need to specify how areas without neighbors are handled using the argument <code>zero.policy = TRUE</code>. This permits the weights list to be formed with zero-length weight vectors.</p>
<p>For example, consider the districts in the country of Scotland.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="thursday-november-17-2022.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;scotlip&quot;</span> <span class="sc">%in%</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))) {</span>
<span id="cb34-2"><a href="thursday-november-17-2022.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/scotlip.zip&quot;</span>,</span>
<span id="cb34-3"><a href="thursday-november-17-2022.html#cb34-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;scotlip.zip&quot;</span>))</span>
<span id="cb34-4"><a href="thursday-november-17-2022.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;scotlip.zip&quot;</span>),</span>
<span id="cb34-5"><a href="thursday-november-17-2022.html#cb34-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb34-6"><a href="thursday-november-17-2022.html#cb34-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-7"><a href="thursday-november-17-2022.html#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="thursday-november-17-2022.html#cb34-8" aria-hidden="true" tabindex="-1"></a>SL.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;scotlip&quot;</span>), </span>
<span id="cb34-9"><a href="thursday-november-17-2022.html#cb34-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">layer =</span> <span class="st">&quot;scotlip&quot;</span>)</span></code></pre></div>
<pre><code>## Reading layer `scotlip&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/QG-2022/data/scotlip&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 56 features and 11 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 95631 ymin: 530297 xmax: 454570 ymax: 1203008
## CRS:           NA</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="thursday-november-17-2022.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SL.sf<span class="sc">$</span>geometry)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Three of the districts are islands. These districts have no bordering districts.</p>
<p>Create a list of neighbors based on contiguity (default).</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="thursday-november-17-2022.html#cb37-1" aria-hidden="true" tabindex="-1"></a>( nbs2 <span class="ot">&lt;-</span> SL.sf <span class="sc">|&gt;</span></span>
<span id="cb37-2"><a href="thursday-november-17-2022.html#cb37-2" aria-hidden="true" tabindex="-1"></a>    spdep<span class="sc">::</span><span class="fu">poly2nb</span>() )</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 56 
## Number of nonzero links: 234 
## Percentage nonzero weights: 7.461735 
## Average number of links: 4.178571 
## 3 regions with no links:
## 6 8 11</code></pre>
<p>Three regions have no neighbors and thus no links.</p>
<p>Use the <code>spdep::nb2listw()</code> function with the argument <code>zero.policy = TRUE</code>. Otherwise you get an error saying the empty neighbor sets are found.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="thursday-november-17-2022.html#cb39-1" aria-hidden="true" tabindex="-1"></a>wts2 <span class="ot">&lt;-</span> nbs2 <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="thursday-november-17-2022.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">nb2listw</span>(<span class="at">zero.policy =</span> <span class="cn">TRUE</span>)</span>
<span id="cb39-3"><a href="thursday-november-17-2022.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(wts2<span class="sc">$</span>weights)</span></code></pre></div>
<pre><code>## [[1]]
## [1] 0.3333333 0.3333333 0.3333333
## 
## [[2]]
## [1] 0.5 0.5
## 
## [[3]]
## [1] 1
## 
## [[4]]
## [1] 0.3333333 0.3333333 0.3333333
## 
## [[5]]
## [1] 0.3333333 0.3333333 0.3333333
## 
## [[6]]
## NULL</code></pre>
<p>The sixth region has no neighbors and so the 6th element of the list is set to <code>NULL</code>.</p>
<p>Once you have a weights matrix defining neighbors and the associated strength of the neighbor relationship, you are ready to compute various statistics of spatial autocorrelation.</p>
</div>
<div id="computing-autocorrelation" class="section level2 unnumbered hasAnchor">
<h2>Computing autocorrelation<a href="thursday-november-17-2022.html#computing-autocorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A commonly used spatial autocorrelation statistic is Moran’s I. Moran’s I follows the basic form of autocorrelation indexes where the similarity between regions <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> is proportional to the product of the deviations from the mean</p>
<p><span class="math display">\[
\hbox{sim}_{ij} \propto (Y_i - \bar Y) (Y_j - \bar Y)
\]</span></p>
<p>where <span class="math inline">\(i\)</span> indexes the region and <span class="math inline">\(j\)</span> indexes the neighbors of <span class="math inline">\(i\)</span>. The value of <span class="math inline">\(\hbox{sim}_{ij}\)</span> is large when the <span class="math inline">\(Y\)</span> values in the product are on the same side of their respective means (both above or below) and small when they are on opposite sides of their respective means (one above and one below or vice versa).</p>
<p>The formula for I is</p>
<p><span class="math display">\[
\hbox{I} = \frac{N} {W} \frac {\sum_{i,j} w_{ij}(Y_i-\bar Y) (Y_j-\bar Y)} {\sum_{i} (Y_i-\bar Y)^2}
\]</span>
where <span class="math inline">\(N\)</span> is the number regions, <span class="math inline">\(w_{ij}\)</span> is the matrix of weights, and <span class="math inline">\(W\)</span> is the sum over all weights.</p>
<p>Consider the following grid of cells containing attribute values.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="thursday-november-17-2022.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(spatstat)) <span class="fu">install.packages</span>(<span class="at">pkgs =</span> <span class="st">&quot;spatstat&quot;</span>, <span class="at">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: spatstat</code></pre>
<pre><code>## Loading required package: spatstat.data</code></pre>
<pre><code>## Loading required package: spatstat.geom</code></pre>
<pre><code>## spatstat.geom 2.4-0</code></pre>
<pre><code>## Loading required package: spatstat.random</code></pre>
<pre><code>## spatstat.random 2.2-0</code></pre>
<pre><code>## Loading required package: spatstat.core</code></pre>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## Loading required package: rpart</code></pre>
<pre><code>## spatstat.core 2.4-4</code></pre>
<pre><code>## Loading required package: spatstat.linnet</code></pre>
<pre><code>## spatstat.linnet 2.3-2</code></pre>
<pre><code>## 
## spatstat 2.3-4       (nickname: &#39;Watch this space&#39;) 
## For an introduction to spatstat, type &#39;beginner&#39;</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="thursday-november-17-2022.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(spatstat))</span>
<span id="cb55-2"><a href="thursday-november-17-2022.html#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="thursday-november-17-2022.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6750</span>)</span>
<span id="cb55-4"><a href="thursday-november-17-2022.html#cb55-4" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="fu">ppp</span>(<span class="fu">runif</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb55-5"><a href="thursday-november-17-2022.html#cb55-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">runif</span>(<span class="dv">200</span>, <span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb55-6"><a href="thursday-november-17-2022.html#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">quadratcount</span>(Y), <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>The formula for Moran’s I results in one value representing the magnitude of the autocorrelation (amount of clustering) over the entire area (global Moran’s I).</p>
<p>First consider a single cell in the area (<span class="math inline">\(N\)</span> = 1). Start with the middle cell (row 3, column 3). Let <span class="math inline">\(i\)</span> = 3 in the above formula and let <span class="math inline">\(j\)</span> index the cells touching the center cell in reading order starting with cell (2, 2), then cell (2, 3), etc.</p>
<p>Assume each neighbor is given a weight of 1/8 so <span class="math inline">\(W = \sum_{j=1}^8 w_j = 1\)</span>. Then the value of I for the single center cell is I_{3, 3} = (6 - mean(y)) * ((8 - mean(y)) + (3 - mean(y)) + (9 - mean(y)) + (12 - mean(y)) + (10 - mean(y)) + (10 - mean(y)) + (9 - mean(y))) / (6 - mean(y))^2)</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="thursday-november-17-2022.html#cb56-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">10</span>, <span class="dv">7</span>, <span class="dv">12</span>, <span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">8</span>, <span class="dv">3</span>, <span class="dv">9</span>, <span class="dv">12</span>, </span>
<span id="cb56-2"><a href="thursday-november-17-2022.html#cb56-2" aria-hidden="true" tabindex="-1"></a>      <span class="dv">6</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">7</span>, </span>
<span id="cb56-3"><a href="thursday-november-17-2022.html#cb56-3" aria-hidden="true" tabindex="-1"></a>      <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">11</span>)</span>
<span id="cb56-4"><a href="thursday-november-17-2022.html#cb56-4" aria-hidden="true" tabindex="-1"></a>( yb <span class="ot">&lt;-</span> <span class="fu">mean</span>(y) )</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="thursday-november-17-2022.html#cb58-1" aria-hidden="true" tabindex="-1"></a>Inum_i <span class="ot">&lt;-</span> (<span class="dv">6</span> <span class="sc">-</span> yb) <span class="sc">*</span> </span>
<span id="cb58-2"><a href="thursday-november-17-2022.html#cb58-2" aria-hidden="true" tabindex="-1"></a>                 ((<span class="dv">8</span> <span class="sc">-</span> yb) <span class="sc">+</span> (<span class="dv">3</span> <span class="sc">-</span> yb) <span class="sc">+</span> (<span class="dv">9</span> <span class="sc">-</span> yb) <span class="sc">+</span> </span>
<span id="cb58-3"><a href="thursday-november-17-2022.html#cb58-3" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">12</span> <span class="sc">-</span> yb) <span class="sc">+</span> (<span class="dv">10</span> <span class="sc">-</span> yb) <span class="sc">+</span> (<span class="dv">10</span> <span class="sc">-</span> yb) <span class="sc">+</span> </span>
<span id="cb58-4"><a href="thursday-november-17-2022.html#cb58-4" aria-hidden="true" tabindex="-1"></a>                  (<span class="dv">10</span> <span class="sc">-</span> yb) <span class="sc">+</span> (<span class="dv">9</span> <span class="sc">-</span> yb))</span>
<span id="cb58-5"><a href="thursday-november-17-2022.html#cb58-5" aria-hidden="true" tabindex="-1"></a>Iden_i <span class="ot">&lt;-</span> (<span class="dv">6</span> <span class="sc">-</span> yb)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb58-6"><a href="thursday-november-17-2022.html#cb58-6" aria-hidden="true" tabindex="-1"></a>Inum_i<span class="sc">/</span>Iden_i</span></code></pre></div>
<pre><code>## [1] -3.5</code></pre>
<p>The I value of -3.5 indicates that the center cell, which has a value below the average over all 25 cells, is mostly surrounded by cells having values above the average.</p>
<p>Now repeat this calculation for every cell and then take the sum over all the 25 I values.</p>
<p>This is what the function <code>spdep::moran()</code> from the {spdep} package does. The first argument is the vector containing the values for which you are interested in determining the magnitude of the spatial autocorrelation and the second argument is the <code>listw</code> object.</p>
<p>Further, you need to specify the number of regions and the sum of the weights <code>S0</code>. The latter is obtained from the <code>spdep::Szero()</code> function applied to the <code>listw</code> object.</p>
<p>Returning to the Columbus crime data here let <code>m</code> be the number of census tracts and <code>s</code> be the sum of the weights. You then apply the <code>spdep::moran()</code> function on the variable <code>CRIME</code>.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="thursday-november-17-2022.html#cb60-1" aria-hidden="true" tabindex="-1"></a>( m <span class="ot">&lt;-</span> CC.sf<span class="sc">$</span>CRIME <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a href="thursday-november-17-2022.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>() )</span></code></pre></div>
<pre><code>## [1] 49</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="thursday-november-17-2022.html#cb62-1" aria-hidden="true" tabindex="-1"></a>( s <span class="ot">&lt;-</span> wts <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="thursday-november-17-2022.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">Szero</span>() )</span></code></pre></div>
<pre><code>## [1] 49</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="thursday-november-17-2022.html#cb64-1" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>CRIME <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a href="thursday-november-17-2022.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">moran</span>(<span class="at">listw =</span> wts, </span>
<span id="cb64-3"><a href="thursday-november-17-2022.html#cb64-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">n =</span> m, </span>
<span id="cb64-4"><a href="thursday-november-17-2022.html#cb64-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">S0 =</span> s)</span></code></pre></div>
<pre><code>## $I
## [1] 0.5001886
## 
## $K
## [1] 2.225946</code></pre>
<p>The function returns the value of Moran’s I and the kurtosis (K) of the distribution of crime values. Moran’s I ranges from -1 to +1.</p>
<p>The value of .5 for the crime rates indicates a high level of spatial autocorrelation. This is expected based on the clustering of crime in the central city.</p>
<p>Positive values of Moran’s I indicate clustering and negative values indicate inhibition. Inhibition is a process leading to nearby values having attribute values that are opposite in magnitude to those at each location (like a checkerboard pattern)</p>
<p>Kurtosis is a statistic that indicates how peaked the distribution of the attribute values is. A normal distribution has a kurtosis of 3. If the kurtosis is too large (or small) relative to a normal distribution then any statistical inference we make with Moran’s I will be suspect.</p>
<p>Read more about Moran’s I here <a href="https://en.wikipedia.org/wiki/Moran%27s_I">Wikipedia Moran’s I</a></p>
<p>Another statistic that indicates the amount of spatial autocorrelation is Geary’s C. The equation is</p>
<p><span class="math display">\[
\hbox{C} = \frac{(N-1) \sum_{i,j} w_{ij} (Y_i-Y_j)^2}{2 W \sum_{i}(Y_i-\bar Y)^2}
\]</span>
where <span class="math inline">\(W\)</span> is the sum over all weights (<span class="math inline">\(w_{ij}\)</span>) and <span class="math inline">\(N\)</span> is the number of areas.</p>
<p>The syntax of the <code>spdep::geary()</code> function is similar that of <code>spdep::moran()</code> except you also need to specify <code>n1</code> as one minus the number of areas.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="thursday-november-17-2022.html#cb66-1" aria-hidden="true" tabindex="-1"></a>CC.sf<span class="sc">$</span>CRIME <span class="sc">|&gt;</span></span>
<span id="cb66-2"><a href="thursday-november-17-2022.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  spdep<span class="sc">::</span><span class="fu">geary</span>(<span class="at">listw =</span> wts,</span>
<span id="cb66-3"><a href="thursday-november-17-2022.html#cb66-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">n =</span> m, </span>
<span id="cb66-4"><a href="thursday-november-17-2022.html#cb66-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">S0 =</span> s, </span>
<span id="cb66-5"><a href="thursday-november-17-2022.html#cb66-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">n1 =</span> m <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## $C
## [1] 0.5405282
## 
## $K
## [1] 2.225946</code></pre>
<p>Values for Geary’s C range from 0 to 2 with 1 indicating no autocorrelation. Values less than 1 indicate positive autocorrelation. Both I and C are global measures of autocorrelation, but C is more sensitive to local variations in autocorrelation.</p>
<p>Rule of thumb: If the interpretation of Geary’s C is much different than the interpretation of Moran’s I then consider computing local measures of autocorrelation.</p>
<p>More information on Geary’s C statistic here <a href="https://en.wikipedia.org/wiki/Geary%27s_C">Wikipedia Geary’s C</a></p>
</div>
<div id="spatial-lag-and-its-relation-to-autocorrelation" class="section level2 unnumbered hasAnchor">
<h2>Spatial lag and its relation to autocorrelation<a href="thursday-november-17-2022.html#spatial-lag-and-its-relation-to-autocorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Understanding Moran’s I is simplified by noted that it is the slope coefficient resulting from a regression of the average neighborhood values onto the observed values. An average of neighborhood values is called the spatial lag variable.</p>
<p>To see this, let <code>crime</code> be the set of crime values (from the Columbus data) in each region as a data vector. You create a spatial lag variable using the <code>spdep::lag.listw()</code> function. The first argument is the <code>listw</code> object and the second is the vector of crime values.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="thursday-november-17-2022.html#cb68-1" aria-hidden="true" tabindex="-1"></a>crime <span class="ot">&lt;-</span> CC.sf<span class="sc">$</span>CRIME</span>
<span id="cb68-2"><a href="thursday-november-17-2022.html#cb68-2" aria-hidden="true" tabindex="-1"></a>Wcrime <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">lag.listw</span>(wts, </span>
<span id="cb68-3"><a href="thursday-november-17-2022.html#cb68-3" aria-hidden="true" tabindex="-1"></a>                           crime)</span></code></pre></div>
<p>For each value in the vector <code>crime</code> there is a corresponding value in the vector <code>Wcrime</code> representing the average crime over the neighboring regions.</p>
<p>To verify, recall tract 1 had tract 2 and 3 as its two neighbors. So the following code should return a <code>TRUE</code>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="thursday-november-17-2022.html#cb69-1" aria-hidden="true" tabindex="-1"></a>(crime[<span class="dv">2</span>] <span class="sc">+</span> crime[<span class="dv">3</span>])<span class="sc">/</span><span class="dv">2</span> <span class="sc">==</span> Wcrime[<span class="dv">1</span>] </span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>The lagged value of crime in tract 1 is equal to the average of the crime in the two neighboring tracts.</p>
<p>Make a scatter plot showing individual observed crime rates on the horizontal axis and the corresponding neighborhood average crime rates on the vertical axis.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="thursday-november-17-2022.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(crime, Wcrime) <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a href="thursday-november-17-2022.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> crime, <span class="at">y =</span> Wcrime)) <span class="sc">+</span> </span>
<span id="cb71-3"><a href="thursday-november-17-2022.html#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb71-4"><a href="thursday-november-17-2022.html#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb71-5"><a href="thursday-november-17-2022.html#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>)) <span class="sc">+</span></span>
<span id="cb71-6"><a href="thursday-november-17-2022.html#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">70</span>)) <span class="sc">+</span></span>
<span id="cb71-7"><a href="thursday-november-17-2022.html#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Crime&quot;</span>) <span class="sc">+</span> </span>
<span id="cb71-8"><a href="thursday-november-17-2022.html#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Average crime in the neighborhood&quot;</span>) <span class="sc">+</span></span>
<span id="cb71-9"><a href="thursday-november-17-2022.html#cb71-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>The range of neighborhood average crime rates is smaller than the range of observed crime rates since the mean of a set of observations will always have less variance (dispersion) than the observations.</p>
<p>The scatter plot shows that tracts with low values of crime tend to be surrounded by tracts with low values of crime on average and tracts with high values of crime tend be surrounded by tracts with high values of crime. The slope on the regression line is upward (positive).</p>
<p>The magnitude of the slope is Moran’s I. To check this use the <code>lm()</code> function from the base set of packages. The function is used to fit linear regression models.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="thursday-november-17-2022.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Wcrime <span class="sc">~</span> crime)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Wcrime ~ crime)
## 
## Coefficients:
## (Intercept)        crime  
##     17.4797       0.5002</code></pre>
<p>The coefficient on the <code>crime</code> variable in the linear regression is .5.</p>
<p>The scatter plot is called a ‘Moran’s scatter plot.’</p>
<p>Let’s consider another data set.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="thursday-november-17-2022.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;sids2&quot;</span> <span class="sc">%in%</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))) {</span>
<span id="cb75-2"><a href="thursday-november-17-2022.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/sids2.zip&quot;</span>,</span>
<span id="cb75-3"><a href="thursday-november-17-2022.html#cb75-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;sids2.zip&quot;</span>))</span>
<span id="cb75-4"><a href="thursday-november-17-2022.html#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;sids2.zip&quot;</span>),</span>
<span id="cb75-5"><a href="thursday-november-17-2022.html#cb75-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb75-6"><a href="thursday-november-17-2022.html#cb75-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb75-7"><a href="thursday-november-17-2022.html#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="thursday-november-17-2022.html#cb75-8" aria-hidden="true" tabindex="-1"></a>SIDS.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;sids2&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb75-9"><a href="thursday-november-17-2022.html#cb75-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_crs</span>(<span class="dv">4326</span>)</span></code></pre></div>
<pre><code>## Reading layer `sids2&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/QG-2022/data/sids2&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 100 features and 18 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -84.32385 ymin: 33.88199 xmax: -75.45698 ymax: 36.58965
## CRS:           NA</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="thursday-november-17-2022.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(SIDS.sf)</span></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 18 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -81.74107 ymin: 36.07282 xmax: -75.77316 ymax: 36.58965
## Geodetic CRS:  WGS 84
##    AREA PERIMETER CNTY_ CNTY_ID        NAME  FIPS FIPSNO CRESS_ID BIR74 SID74
## 1 0.114     1.442  1825    1825        Ashe 37009  37009        5  1091     1
## 2 0.061     1.231  1827    1827   Alleghany 37005  37005        3   487     0
## 3 0.143     1.630  1828    1828       Surry 37171  37171       86  3188     5
## 4 0.070     2.968  1831    1831   Currituck 37053  37053       27   508     1
## 5 0.153     2.206  1832    1832 Northampton 37131  37131       66  1421     9
## 6 0.097     1.670  1833    1833    Hertford 37091  37091       46  1452     7
##   NWBIR74 BIR79 SID79 NWBIR79   SIDR74   SIDR79      NWR74     NWR79
## 1      10  1364     0      19 0.916590 0.000000   9.165903  13.92962
## 2      10   542     3      12 0.000000 5.535055  20.533881  22.14022
## 3     208  3616     6     260 1.568381 1.659292  65.244668  71.90265
## 4     123   830     2     145 1.968504 2.409639 242.125984 174.69879
## 5    1066  1606     3    1197 6.333568 1.867995 750.175932 745.33001
## 6     954  1838     5    1237 4.820937 2.720348 657.024793 673.01415
##                         geometry
## 1 MULTIPOLYGON (((-81.47276 3...
## 2 MULTIPOLYGON (((-81.23989 3...
## 3 MULTIPOLYGON (((-80.45634 3...
## 4 MULTIPOLYGON (((-76.00897 3...
## 5 MULTIPOLYGON (((-77.21767 3...
## 6 MULTIPOLYGON (((-76.74506 3...</code></pre>
<p>The column <code>SIDR79</code> contains the death rate (per 1000 live births) (1979-84) from sudden infant death syndrome. Create a choropleth map of the SIDS rates.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="thursday-november-17-2022.html#cb79-1" aria-hidden="true" tabindex="-1"></a>tmap<span class="sc">::</span><span class="fu">tm_shape</span>(SIDS.sf) <span class="sc">+</span></span>
<span id="cb79-2"><a href="thursday-november-17-2022.html#cb79-2" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_fill</span>(<span class="st">&quot;SIDR79&quot;</span>, <span class="at">title =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-3"><a href="thursday-november-17-2022.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb79-4"><a href="thursday-november-17-2022.html#cb79-4" aria-hidden="true" tabindex="-1"></a>  tmap<span class="sc">::</span><span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;SIDS Rates 1979-84 [per 1000]&quot;</span>,</span>
<span id="cb79-5"><a href="thursday-november-17-2022.html#cb79-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>Create a neighborhood list (<code>nb</code>) and a <code>listw</code> object (<code>wts</code>) then graph the neighborhood network.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="thursday-november-17-2022.html#cb80-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(SIDS.sf)</span>
<span id="cb80-2"><a href="thursday-november-17-2022.html#cb80-2" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs)</span>
<span id="cb80-3"><a href="thursday-november-17-2022.html#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="thursday-november-17-2022.html#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nbs, </span>
<span id="cb80-5"><a href="thursday-november-17-2022.html#cb80-5" aria-hidden="true" tabindex="-1"></a>     sf<span class="sc">::</span><span class="fu">st_centroid</span>(sf<span class="sc">::</span><span class="fu">st_geometry</span>(SIDS.sf)))</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Next compute Moran’s I on the SIDS rates using the variable <code>SIDR79</code> (1974-1979).</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="thursday-november-17-2022.html#cb81-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">length</span>(SIDS.sf<span class="sc">$</span>SIDR79)</span>
<span id="cb81-2"><a href="thursday-november-17-2022.html#cb81-2" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">Szero</span>(wts)</span>
<span id="cb81-3"><a href="thursday-november-17-2022.html#cb81-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-4"><a href="thursday-november-17-2022.html#cb81-4" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran</span>(SIDS.sf<span class="sc">$</span>SIDR79, </span>
<span id="cb81-5"><a href="thursday-november-17-2022.html#cb81-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">listw =</span> wts, </span>
<span id="cb81-6"><a href="thursday-november-17-2022.html#cb81-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> m, </span>
<span id="cb81-7"><a href="thursday-november-17-2022.html#cb81-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">S0 =</span> s)</span></code></pre></div>
<pre><code>## $I
## [1] 0.1427504
## 
## $K
## [1] 4.44434</code></pre>
<p>I is .14 and K is 4.4. A normal distribution has a kurtosis of 3. Values less than about 2 or greater than about 4 indicate that inferences about autocorrelation based on the assumption of normality are suspect.</p>
<p>Weights are specified using the <code>style =</code> argument in the <code>nb2listw()</code> function. The default “W” is row standardized (sum of the weights over all links equals the number of polygons). “B” is binary (each neighbor gets a weight of one). “S” is a variance stabilizing scheme.</p>
<p>Each style gives a somewhat different value for I.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="thursday-november-17-2022.html#cb83-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> SIDS.sf<span class="sc">$</span>SIDR79</span>
<span id="cb83-2"><a href="thursday-november-17-2022.html#cb83-2" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran.test</span>(x, spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs, <span class="at">style =</span> <span class="st">&quot;W&quot;</span>))<span class="sc">$</span>estimate[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## Moran I statistic 
##         0.1427504</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="thursday-november-17-2022.html#cb85-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran.test</span>(x, spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs, <span class="at">style =</span> <span class="st">&quot;B&quot;</span>))<span class="sc">$</span>estimate[<span class="dv">1</span>]  <span class="co"># binary</span></span></code></pre></div>
<pre><code>## Moran I statistic 
##         0.1105207</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="thursday-november-17-2022.html#cb87-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran.test</span>(x, spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs, <span class="at">style =</span> <span class="st">&quot;S&quot;</span>))<span class="sc">$</span>estimate[<span class="dv">1</span>]  <span class="co"># variance-stabilizing</span></span></code></pre></div>
<pre><code>## Moran I statistic 
##         0.1260686</code></pre>
<p>When reporting a Moran’s I you need to state what type of weighting was used.</p>
<p>Let <code>sids</code> be a vector with elements containing the SIDS rate in each county. You create a spatial lag variable using the <code>spdep::lag.listw()</code> function. The first argument is the <code>listw</code> object and the second is the vector of rates.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="thursday-november-17-2022.html#cb89-1" aria-hidden="true" tabindex="-1"></a>sids <span class="ot">&lt;-</span> SIDS.sf<span class="sc">$</span>SIDR79</span>
<span id="cb89-2"><a href="thursday-november-17-2022.html#cb89-2" aria-hidden="true" tabindex="-1"></a>Wsids <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">lag.listw</span>(wts, </span>
<span id="cb89-3"><a href="thursday-november-17-2022.html#cb89-3" aria-hidden="true" tabindex="-1"></a>                          sids)</span></code></pre></div>
<p>For each value in the vector <code>sids</code> there is a corresponding value in the object <code>Wsids</code> representing the neighborhood average SIDS rate.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="thursday-november-17-2022.html#cb90-1" aria-hidden="true" tabindex="-1"></a>Wsids[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 2.65921</code></pre>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="thursday-november-17-2022.html#cb92-1" aria-hidden="true" tabindex="-1"></a>j <span class="ot">&lt;-</span> wts<span class="sc">$</span>neighbours[[<span class="dv">1</span>]]</span>
<span id="cb92-2"><a href="thursday-november-17-2022.html#cb92-2" aria-hidden="true" tabindex="-1"></a>j</span></code></pre></div>
<pre><code>## [1]  2 18 19</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="thursday-november-17-2022.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(SIDS.sf<span class="sc">$</span>SIDR79[j])<span class="sc">/</span><span class="fu">length</span>(j)</span></code></pre></div>
<pre><code>## [1] 2.65921</code></pre>
<p>The weight for county one is <code>Wsids[1]</code> = 2.659. The neighbor indexes for this county are in the vector <code>wts$neighbours[[1]]</code> of length 3. Add the SIDS rates from those counties and divide by the number of counties (<code>length(j)</code>).</p>
<p>A scatter plot of the neighborhood average SIDS rate versus the actual SIDS rate in each region.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="thursday-november-17-2022.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(sids, Wsids) <span class="sc">|&gt;</span></span>
<span id="cb96-2"><a href="thursday-november-17-2022.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> sids, <span class="at">y =</span> Wsids)) <span class="sc">+</span> </span>
<span id="cb96-3"><a href="thursday-november-17-2022.html#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb96-4"><a href="thursday-november-17-2022.html#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm) <span class="sc">+</span></span>
<span id="cb96-5"><a href="thursday-november-17-2022.html#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb96-6"><a href="thursday-november-17-2022.html#cb96-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb96-7"><a href="thursday-november-17-2022.html#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;SIDS&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Spatial Lag of SIDS&quot;</span>) <span class="sc">+</span></span>
<span id="cb96-8"><a href="thursday-november-17-2022.html#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<p>The regression line slopes upward indicating positive spatial autocorrelation. The value of the slope is Moran’s I. To check this type</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="thursday-november-17-2022.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(Wsids <span class="sc">~</span> sids)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Wsids ~ sids)
## 
## Coefficients:
## (Intercept)         sids  
##      1.7622       0.1428</code></pre>
</div>
<div id="other-neighbor-definitions" class="section level2 unnumbered hasAnchor">
<h2>Other neighbor definitions<a href="thursday-november-17-2022.html#other-neighbor-definitions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Other neighbor definitions are possible and the choice will influence the value of any statistic of spatial autocorrelation.</p>
<p>Let’s consider the historical demographic data in Mississippi counties. Import the data as a simple feature data frame and assign the geometry a geographic CRS.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="thursday-november-17-2022.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">&quot;police&quot;</span> <span class="sc">%in%</span> <span class="fu">list.files</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))) {</span>
<span id="cb100-2"><a href="thursday-november-17-2022.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">&quot;http://myweb.fsu.edu/jelsner/temp/data/police.zip&quot;</span>,</span>
<span id="cb100-3"><a href="thursday-november-17-2022.html#cb100-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;police.zip&quot;</span>))</span>
<span id="cb100-4"><a href="thursday-november-17-2022.html#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;police.zip&quot;</span>),</span>
<span id="cb100-5"><a href="thursday-november-17-2022.html#cb100-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">exdir =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb100-6"><a href="thursday-november-17-2022.html#cb100-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb100-7"><a href="thursday-november-17-2022.html#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="thursday-november-17-2022.html#cb100-8" aria-hidden="true" tabindex="-1"></a>( PE.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;police&quot;</span>), </span>
<span id="cb100-9"><a href="thursday-november-17-2022.html#cb100-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">layer =</span> <span class="st">&quot;police&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb100-10"><a href="thursday-november-17-2022.html#cb100-10" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_crs</span>(<span class="dv">4326</span>) )</span></code></pre></div>
<pre><code>## Reading layer `police&#39; from data source 
##   `/Users/jelsner/Desktop/ClassNotes/QG-2022/data/police&#39; using driver `ESRI Shapefile&#39;
## Simple feature collection with 82 features and 21 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -91.64356 ymin: 30.19474 xmax: -88.09043 ymax: 35.00496
## CRS:           NA</code></pre>
<pre><code>## Simple feature collection with 82 features and 21 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -91.64356 ymin: 30.19474 xmax: -88.09043 ymax: 35.00496
## Geodetic CRS:  WGS 84
## First 10 features:
##     AREA PERIMETER CNTY_ CNTY_ID       NAME  STATE_NAME STATE_FIPS CNTY_FIPS
## 1  0.105     1.401  2129    2129     Alcorn Mississippi         28       003
## 2  0.111     1.485  2130    2130 Tishomingo Mississippi         28       141
## 3  0.116     1.519  2131    2131     Tippah Mississippi         28       139
## 4  0.105     1.478  2132    2132     Benton Mississippi         28       009
## 5  0.127     1.774  2133    2133    De Soto Mississippi         28       033
## 6  0.181     1.911  2134    2134   Marshall Mississippi         28       093
## 7  0.119     2.146  2155    2155     Tunica Mississippi         28       143
## 8  0.103     1.571  2171    2171       Tate Mississippi         28       137
## 9  0.106     1.394  2176    2176   Prentiss Mississippi         28       117
## 10 0.109     1.493  2199    2199      Union Mississippi         28       145
##     FIPS FIPSNO POLICE   POP TAX TRANSFER  INC CRIME UNEMP OWN COLLEGE WHITE
## 1  28003  28003    706 32500 122    12428 8206    43     7  70      23    89
## 2  28141  28141    247 19100 112     7278 6666   316     8  73      18    96
## 3  28139  28139    296 18800  93     8606 6865     5     7  71      18    84
## 4  28009  28009    116  8400 100     3494 6083    24    12  75      16    62
## 5  28033  28033   1063 56400 116    18555 8731    36     6  77      26    82
## 6  28093  28093    549 30900  87    10370 5825   316    11  71      22    47
## 7  28143  28143    291  9500 153     5354 6019    42    15  43      18    27
## 8  28137  28137    444 20500 137    13783 7837    20     8  67      29    61
## 9  28117  28117    455 24400 118    14650 6361    41     6  74      20    89
## 10 28145  28145    364 21400 117     8207 7530    46     5  73      22    86
##    COMMUTE                       geometry
## 1        8 POLYGON ((-88.35416 34.7626...
## 2        8 POLYGON ((-88.32171 34.4693...
## 3       15 POLYGON ((-88.72614 34.6048...
## 4       41 POLYGON ((-89.23874 34.5935...
## 5        2 POLYGON ((-90.20186 34.7297...
## 6       12 POLYGON ((-89.66407 34.5659...
## 7        3 POLYGON ((-90.19978 34.5617...
## 8       11 POLYGON ((-89.71541 34.5659...
## 9       23 POLYGON ((-88.32171 34.4693...
## 10      20 POLYGON ((-89.24072 34.5017...</code></pre>
<p>Variables in the simple feature data frame include police expenditures (<code>POLICE</code>), crime (<code>CRIME</code>), income (<code>INC</code>), unemployment (<code>UNEMP</code>) and other socio-economic characteristics across Mississippi at the county level. Police expenditures are per person 1982 (dollars per person). Personal income is per person in 1982 (dollars per person). Crime is the number of serious crimes per 100,000 person in 1981. Unemployment is percent of people looking for work in 1980.</p>
<p>The geometries are polygons that define the county borders.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="thursday-november-17-2022.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb103-2"><a href="thursday-november-17-2022.html#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="thursday-november-17-2022.html#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> PE.sf) <span class="sc">+</span></span>
<span id="cb103-4"><a href="thursday-november-17-2022.html#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>To estimate autocorrelation for any variable in the data frame, you need to first assign the neighbors and weights for each region.</p>
<p>The default options in the <code>spdep::poly2nb()</code> and <code>spdep::nb2listw()</code> result in neighbors defined by ‘queen’ contiguity (polygon intersections can include a single point) and weights defined by row standardization (the sum of the weights equals the number of regions).</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="thursday-november-17-2022.html#cb104-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(PE.sf)</span>
<span id="cb104-2"><a href="thursday-november-17-2022.html#cb104-2" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs)</span></code></pre></div>
<p>Alternatively you can specify the number of neighbors and then assign neighbors based on proximity (closeness). Here you first extract the coordinates of the polygon centroids as a matrix.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="thursday-november-17-2022.html#cb105-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> PE.sf <span class="sc">|&gt;</span></span>
<span id="cb105-2"><a href="thursday-november-17-2022.html#cb105-2" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_centroid</span>() <span class="sc">|&gt;</span></span>
<span id="cb105-3"><a href="thursday-november-17-2022.html#cb105-3" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_coordinates</span>()</span></code></pre></div>
<pre><code>## Warning in st_centroid.sf(PE.sf): st_centroid assumes attributes are constant
## over geometries of x</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="thursday-november-17-2022.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coords)</span></code></pre></div>
<pre><code>##           X        Y
## 1 -88.56938 34.88746
## 2 -88.23073 34.74665
## 3 -88.89928 34.77600
## 4 -89.17942 34.82323
## 5 -89.98973 34.88099
## 6 -89.49699 34.76984</code></pre>
<p>Then use the <code>spdep::knearneigh()</code> function on the coordinate matrix and specify the number of neighbors with the <code>k =</code> argument. Here you set it to six. That is, allow each county to have 6 closest neighbors.</p>
<p>Since the CRS is geographic you need to include the <code>longlat = TRUE</code> argument so distances are calculated using great circles.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="thursday-november-17-2022.html#cb109-1" aria-hidden="true" tabindex="-1"></a>knn <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">knearneigh</span>(coords, </span>
<span id="cb109-2"><a href="thursday-november-17-2022.html#cb109-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">k =</span> <span class="dv">6</span>, </span>
<span id="cb109-3"><a href="thursday-november-17-2022.html#cb109-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">longlat =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-4"><a href="thursday-november-17-2022.html#cb109-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(knn)</span></code></pre></div>
<pre><code>## [1] &quot;nn&quot;        &quot;np&quot;        &quot;k&quot;         &quot;dimension&quot; &quot;x&quot;</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="thursday-november-17-2022.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(knn<span class="sc">$</span>nn)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]    9    3    2    4   10   14
## [2,]    9    1   16    3   14   10
## [3,]    4   10    1    9    6   14
## [4,]    3    6   10    1   11    9
## [5,]    8    7    6   12   11    4
## [6,]    4    8   11    5    3   10</code></pre>
<p>The output is a list of five elements with the first element a matrix with the row dimension the number of counties and the column dimension the number of neighbors.</p>
<p>Note that by using distance to define neighbors the matrix is not symmetric. For example, county 3 is a neighbor of county 2, but county 2 is not a neighbor of county 3.</p>
<p>Certain spatial regression models require the neighbor matrix to be symmetric. That is if region X is a neighbor of region Y then region Y must be a neighbor of region X.</p>
<p>You turn this matrix into a neighbor object (class <code>nb</code>) with the <code>spdep::knn2nb()</code> function.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="thursday-november-17-2022.html#cb113-1" aria-hidden="true" tabindex="-1"></a>nbs2 <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">knn2nb</span>(knn)</span>
<span id="cb113-2"><a href="thursday-november-17-2022.html#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nbs2)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 82 
## Number of nonzero links: 492 
## Percentage nonzero weights: 7.317073 
## Average number of links: 6 
## Non-symmetric neighbours list
## Link number distribution:
## 
##  6 
## 82 
## 82 least connected regions:
## 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 with 6 links
## 82 most connected regions:
## 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 with 6 links</code></pre>
<p>If you include the argument <code>sym = TRUE</code> in the <code>knn2nb()</code> function then it forces the neighbor matrix to be symmetric.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="thursday-november-17-2022.html#cb115-1" aria-hidden="true" tabindex="-1"></a>nbs3 <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">knn2nb</span>(knn,</span>
<span id="cb115-2"><a href="thursday-november-17-2022.html#cb115-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sym =</span> <span class="cn">TRUE</span>)</span>
<span id="cb115-3"><a href="thursday-november-17-2022.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nbs3)</span></code></pre></div>
<pre><code>## Neighbour list object:
## Number of regions: 82 
## Number of nonzero links: 568 
## Percentage nonzero weights: 8.447353 
## Average number of links: 6.926829 
## Link number distribution:
## 
##  6  7  8  9 10 
## 37 25 13  3  4 
## 37 least connected regions:
## 1 2 5 6 7 8 13 16 18 21 22 28 31 33 34 40 42 44 45 46 48 49 50 54 57 59 62 63 65 73 74 76 77 78 80 81 82 with 6 links
## 4 most connected regions:
## 10 19 66 70 with 10 links</code></pre>
<p>The result shows that six is now the minimum number of nearest neighbors with some counties having has many as 10 neighbors to guarantee symmetry.</p>
<p>Compare the default adjacency neighborhoods with the nearest-neighbor neighborhoods.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="thursday-november-17-2022.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_geometry</span>(PE.sf), <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb117-2"><a href="thursday-november-17-2022.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nbs, coords, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="thursday-november-17-2022.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_geometry</span>(PE.sf), <span class="at">border =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb118-2"><a href="thursday-november-17-2022.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nbs2, coords, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-42-2.png" width="672" /></p>
<p>A difference between the two neighborhoods is the number of links on counties along the borders. The nearest-neighbor defined neighborhoods have more links. Note: when neighbors are defined by proximity counties can share a border but they still may not be neighbors.</p>
<p>Your choice of neighbors is based on domain specific knowledge. If the process you are interested in can be described by a dispersal mechanism then proximity definition might be the right choice for defining neighbors. If the process can be described by a border diffusion mechanism then contiguity might be the right choice.</p>
<p>Create weight matrices for these alternative neighborhoods using the same <code>spdep::nb2listw()</code> function.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="thursday-november-17-2022.html#cb119-1" aria-hidden="true" tabindex="-1"></a>wts2 <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs2)</span>
<span id="cb119-2"><a href="thursday-november-17-2022.html#cb119-2" aria-hidden="true" tabindex="-1"></a>wts3 <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs3)</span></code></pre></div>
<p>You compute Moran’s I for the percentage of white people variable (<code>WHITE</code>) with the <code>moran()</code> function separately for the three different weight matrices.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="thursday-november-17-2022.html#cb120-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran</span>(PE.sf<span class="sc">$</span>WHITE,</span>
<span id="cb120-2"><a href="thursday-november-17-2022.html#cb120-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">listw =</span> wts,</span>
<span id="cb120-3"><a href="thursday-november-17-2022.html#cb120-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">length</span>(nbs),</span>
<span id="cb120-4"><a href="thursday-november-17-2022.html#cb120-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">S0 =</span> spdep<span class="sc">::</span><span class="fu">Szero</span>(wts))</span></code></pre></div>
<pre><code>## $I
## [1] 0.5634778
## 
## $K
## [1] 2.300738</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="thursday-november-17-2022.html#cb122-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran</span>(PE.sf<span class="sc">$</span>WHITE,</span>
<span id="cb122-2"><a href="thursday-november-17-2022.html#cb122-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">listw =</span> wts2,</span>
<span id="cb122-3"><a href="thursday-november-17-2022.html#cb122-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">length</span>(nbs2),</span>
<span id="cb122-4"><a href="thursday-november-17-2022.html#cb122-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">S0 =</span> spdep<span class="sc">::</span><span class="fu">Szero</span>(wts2))</span></code></pre></div>
<pre><code>## $I
## [1] 0.5506132
## 
## $K
## [1] 2.300738</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="thursday-november-17-2022.html#cb124-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran</span>(PE.sf<span class="sc">$</span>WHITE,</span>
<span id="cb124-2"><a href="thursday-november-17-2022.html#cb124-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">listw =</span> wts3,</span>
<span id="cb124-3"><a href="thursday-november-17-2022.html#cb124-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">length</span>(nbs3),</span>
<span id="cb124-4"><a href="thursday-november-17-2022.html#cb124-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">S0 =</span> spdep<span class="sc">::</span><span class="fu">Szero</span>(wts3))</span></code></pre></div>
<pre><code>## $I
## [1] 0.5592557
## 
## $K
## [1] 2.300738</code></pre>
<p>Values of Moran’s I are constrained between -1 and +1. In this case the neighborhood definition has little or no impact on inferences made about spatial autocorrelation. The kurtosis is between 2 and 4 consistent with a set of values from a normal distribution.</p>
<p>In a similar way you compute the Geary’s C statistic.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="thursday-november-17-2022.html#cb126-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">geary</span>(PE.sf<span class="sc">$</span>WHITE, </span>
<span id="cb126-2"><a href="thursday-november-17-2022.html#cb126-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">listw =</span> wts,</span>
<span id="cb126-3"><a href="thursday-november-17-2022.html#cb126-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">n =</span> <span class="fu">length</span>(nbs), </span>
<span id="cb126-4"><a href="thursday-november-17-2022.html#cb126-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">S0 =</span> spdep<span class="sc">::</span><span class="fu">Szero</span>(wts), </span>
<span id="cb126-5"><a href="thursday-november-17-2022.html#cb126-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">n1 =</span> <span class="fu">length</span>(nbs) <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## $C
## [1] 0.4123818
## 
## $K
## [1] 2.300738</code></pre>
<p>Values of Geary’s C range between 0 and 2 with values less than one indicating positive autocorrelation.</p>
<p>If the values of Moran’s I and Geary’s C result in different interpretations about the amount of clustering then it is a good idea to examine <em>local</em> variations in autocorrelation.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tuesday-november-15-2022.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tuesday-november-22-2022.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
