<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Tuesday, November 15, 2022 | GEO5156: Quantitative Geography</title>
  <meta name="description" content="Tuesday, November 15, 2022 | GEO5156: Quantitative Geography" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Tuesday, November 15, 2022 | GEO5156: Quantitative Geography" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="jelsner/QG-2022" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Tuesday, November 15, 2022 | GEO5156: Quantitative Geography" />
  
  
  

<meta name="author" content="James B. Elsner" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="thursday-november-10-2022.html"/>
<link rel="next" href="thursday-november-17-2022.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/viz-1.8.2/viz.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/grViz-binding-1.0.9/grViz.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quantitative Geography</a></li>

<li class="divider"></li>
<li><a href="index.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html"><i class="fa fa-check"></i>Syllabus</a>
<ul>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#geo5165c-quantitative-geography"><i class="fa fa-check"></i>GEO5165C: Quantitative Geography</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#contact-information"><i class="fa fa-check"></i>Contact information</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#course-description"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#grades"><i class="fa fa-check"></i>Grades</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#ethics"><i class="fa fa-check"></i>Ethics</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#schedule-subject-to-change-with-notice"><i class="fa fa-check"></i>Schedule (subject to change with notice)</a></li>
<li class="chapter" data-level="" data-path="syllabus.html"><a href="syllabus.html#other-relevant-materials"><i class="fa fa-check"></i>Other relevant materials</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html"><i class="fa fa-check"></i>Tuesday, August 23, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#today"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#what-is-this-course"><i class="fa fa-check"></i>What is this course?</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#where-are-the-materials-for-this-course"><i class="fa fa-check"></i>Where are the materials for this course?</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#examples"><i class="fa fa-check"></i>Examples</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#course-syllabus"><i class="fa fa-check"></i>Course Syllabus</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#getting-setup-for-this-course"><i class="fa fa-check"></i>Getting setup for this course</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#the-rstudio-ide"><i class="fa fa-check"></i>The RStudio IDE</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-23-2022.html"><a href="tuesday-august-23-2022.html#tallahassee-daily-temperatures"><i class="fa fa-check"></i>Tallahassee daily temperatures</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html"><i class="fa fa-check"></i>Thursday, August 25, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#today-1"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#data-analysis"><i class="fa fa-check"></i>Data Analysis</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#reproducibility"><i class="fa fa-check"></i>Reproducibility</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#communication"><i class="fa fa-check"></i>Communication</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#automation"><i class="fa fa-check"></i>Automation</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#the-r-programming-language"><i class="fa fa-check"></i>The R programming language</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#overview-of-this-course"><i class="fa fa-check"></i>Overview of this course</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#work-in-plain-text-using-r-markdown"><i class="fa fa-check"></i>Work in plain text, using R Markdown</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#visualizing-data"><i class="fa fa-check"></i>Visualizing data</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#a-code-template"><i class="fa fa-check"></i>A code template</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#the-code"><i class="fa fa-check"></i>The code</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#a-graphing-workflow"><i class="fa fa-check"></i>A graphing workflow</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#a-graphing-template"><i class="fa fa-check"></i>A graphing template</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#common-problems"><i class="fa fa-check"></i>Common problems</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#location-of-the-sign"><i class="fa fa-check"></i>location of the <code>+</code> sign</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#help"><i class="fa fa-check"></i>help</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#things-to-know"><i class="fa fa-check"></i>Things to know</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#everything-has-a-name"><i class="fa fa-check"></i>Everything has a name</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#everything-is-an-object"><i class="fa fa-check"></i>Everything is an object</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#you-do-things-using-functions"><i class="fa fa-check"></i>You do things using functions</a></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#functions-come-in-packages-libraries"><i class="fa fa-check"></i>Functions come in packages (libraries)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-august-25-2022.html"><a href="thursday-august-25-2022.html#your-turn"><i class="fa fa-check"></i>Your turn</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html"><i class="fa fa-check"></i>Tuesday, August 30, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#today-2"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#scatter-plots"><i class="fa fa-check"></i>Scatter plots</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#facets"><i class="fa fa-check"></i>Facets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#calculations"><i class="fa fa-check"></i>Calculations</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#functions"><i class="fa fa-check"></i>Functions</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#syntax-is-important"><i class="fa fa-check"></i>Syntax is important</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#saving-an-object"><i class="fa fa-check"></i>Saving an object</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#object-names"><i class="fa fa-check"></i>Object names</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#entering-data"><i class="fa fa-check"></i>Entering data</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#applying-a-function"><i class="fa fa-check"></i>Applying a function</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#averge"><i class="fa fa-check"></i>Averge</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#data-vectors"><i class="fa fa-check"></i>Data vectors</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#variance"><i class="fa fa-check"></i>Variance</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#data-vectors-have-a-type"><i class="fa fa-check"></i>Data vectors have a type</a></li>
<li class="chapter" data-level="" data-path="tuesday-august-30-2022.html"><a href="tuesday-august-30-2022.html#working-smarter"><i class="fa fa-check"></i>Working smarter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html"><i class="fa fa-check"></i>Thursday, September 1, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#today-3"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#data-as-vectors"><i class="fa fa-check"></i>Data as vectors</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#mean"><i class="fa fa-check"></i>Mean</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#variance-1"><i class="fa fa-check"></i>Variance</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#median"><i class="fa fa-check"></i>Median</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#spread"><i class="fa fa-check"></i>Spread</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#vector-types"><i class="fa fa-check"></i>Vector types</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#structured-data"><i class="fa fa-check"></i>Structured data</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#asking-questions"><i class="fa fa-check"></i>Asking questions</a></li>
<li class="chapter" data-level="" data-path="thursday-september-1-2022.html"><a href="thursday-september-1-2022.html#tables-and-summaries"><i class="fa fa-check"></i>Tables and summaries</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html"><i class="fa fa-check"></i>Tuesday, September 6, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#today-4"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#getting-your-data-into-r"><i class="fa fa-check"></i>Getting your data into R</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#creating-structured-data-files"><i class="fa fa-check"></i>Creating structured data files</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#data-frames"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#quantiles"><i class="fa fa-check"></i>Quantiles</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#creating-a-data-frame"><i class="fa fa-check"></i>Creating a data frame</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#pipes"><i class="fa fa-check"></i>Pipes</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-6-2022.html"><a href="tuesday-september-6-2022.html#your-turn-1"><i class="fa fa-check"></i>Your turn</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html"><i class="fa fa-check"></i>Thursday, September 8, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#today-5"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#pipe-operator"><i class="fa fa-check"></i>Pipe operator</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#wrangling-data-frames"><i class="fa fa-check"></i>Wrangling data frames</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#selecting-and-filtering"><i class="fa fa-check"></i>Selecting and filtering</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#example-palmer-penguins"><i class="fa fa-check"></i>Example: Palmer penguins</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#stringing-functions-together"><i class="fa fa-check"></i>Stringing functions together</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#summarize"><i class="fa fa-check"></i>Summarize</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#grouping"><i class="fa fa-check"></i>Grouping</a></li>
<li class="chapter" data-level="" data-path="thursday-september-8-2022.html"><a href="thursday-september-8-2022.html#your-turn-2"><i class="fa fa-check"></i>Your turn</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html"><i class="fa fa-check"></i>Tuesday, September 13, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#today-6"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#example-1-new-york-city-flight-data"><i class="fa fa-check"></i>Example 1: New York City flight data</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#example-2-daily-weather-data-from-tallahassee"><i class="fa fa-check"></i>Example 2: Daily weather data from Tallahassee</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#putting-everything-together"><i class="fa fa-check"></i>Putting everything together</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#example-3-food-consumption-and-co2-emissions"><i class="fa fa-check"></i>Example 3: Food consumption and CO2 emissions</a></li>
<li class="chapter" data-level="" data-path="tuesday-september-13-2022.html"><a href="tuesday-september-13-2022.html#summary"><i class="fa fa-check"></i>Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html"><i class="fa fa-check"></i>Thursday, September 15, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#today-7"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#bar-chart"><i class="fa fa-check"></i>Bar chart</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#pie-preference"><i class="fa fa-check"></i>Pie preference</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#histogram"><i class="fa fa-check"></i>Histogram</a></li>
<li class="chapter" data-level="" data-path="thursday-september-15-2022.html"><a href="thursday-september-15-2022.html#transforming-the-response-variable"><i class="fa fa-check"></i>Transforming the response variable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html"><i class="fa fa-check"></i>Thursday, October 20, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#today-8"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#example-average-income-vs-percent-college-graduates-at-the-state-level"><i class="fa fa-check"></i>Example: Average income vs percent college graduates at the state level</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#outliers"><i class="fa fa-check"></i>Outliers</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#summarizing"><i class="fa fa-check"></i>Summarizing</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#example-a-regression-model-for-trend"><i class="fa fa-check"></i>Example: A regression model for trend</a></li>
<li class="chapter" data-level="" data-path="thursday-october-20-2022.html"><a href="thursday-october-20-2022.html#simpsons-paradox"><i class="fa fa-check"></i>Simpson’s paradox</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html"><i class="fa fa-check"></i>Tuesday, October 25, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#today-9"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#multiple-variable-linear-regression"><i class="fa fa-check"></i>Multiple variable linear regression</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#a-grid-of-scatter-plots"><i class="fa fa-check"></i>A grid of scatter plots</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#fit-a-multiple-variable-regression-model"><i class="fa fa-check"></i>Fit a multiple variable regression model</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#should-you-remove-a-variable-from-the-model"><i class="fa fa-check"></i>Should you remove a variable from the model?</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#checking-on-the-model-assumptions"><i class="fa fa-check"></i>Checking on the model assumptions</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#checking-predictions"><i class="fa fa-check"></i>Checking predictions</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#example-predicting-house-prices"><i class="fa fa-check"></i>Example: Predicting house prices</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#collinearity"><i class="fa fa-check"></i>Collinearity</a></li>
<li class="chapter" data-level="" data-path="tuesday-october-25-2022.html"><a href="tuesday-october-25-2022.html#interactions"><i class="fa fa-check"></i>Interactions</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-october-27-2022.html"><a href="thursday-october-27-2022.html"><i class="fa fa-check"></i>Thursday, October 27, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-october-27-2022.html"><a href="thursday-october-27-2022.html#today-10"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-october-27-2022.html"><a href="thursday-october-27-2022.html#removing-variables-from-a-model"><i class="fa fa-check"></i>Removing variables from a model</a></li>
<li class="chapter" data-level="" data-path="thursday-october-27-2022.html"><a href="thursday-october-27-2022.html#the-stepwise-regression-procedure"><i class="fa fa-check"></i>The stepwise regression procedure</a></li>
<li class="chapter" data-level="" data-path="thursday-october-27-2022.html"><a href="thursday-october-27-2022.html#transforming-a-response-variable"><i class="fa fa-check"></i>Transforming a response variable</a></li>
<li class="chapter" data-level="" data-path="thursday-october-27-2022.html"><a href="thursday-october-27-2022.html#regression-trees"><i class="fa fa-check"></i>Regression trees</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html"><i class="fa fa-check"></i>Tuesday, November 1, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#today-11"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#regression-tree-example"><i class="fa fa-check"></i>Regression tree example</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#predictive-uncertainty"><i class="fa fa-check"></i>Predictive uncertainty</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#random-forest-algorithm"><i class="fa fa-check"></i>Random forest algorithm</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#cross-validation"><i class="fa fa-check"></i>Cross validation</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-1-2022.html"><a href="tuesday-november-1-2022.html#classification-trees"><i class="fa fa-check"></i>Classification trees</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-november-3-2022.html"><a href="thursday-november-3-2022.html"><i class="fa fa-check"></i>Thursday, November 3, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-november-3-2022.html"><a href="thursday-november-3-2022.html#today-12"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-november-3-2022.html"><a href="thursday-november-3-2022.html#binary-outcomes-and-probabilities"><i class="fa fa-check"></i>Binary outcomes and probabilities</a></li>
<li class="chapter" data-level="" data-path="thursday-november-3-2022.html"><a href="thursday-november-3-2022.html#logistic-regression"><i class="fa fa-check"></i>Logistic regression</a></li>
<li class="chapter" data-level="" data-path="thursday-november-3-2022.html"><a href="thursday-november-3-2022.html#example-who-survives-in-the-donner-party"><i class="fa fa-check"></i>Example: Who survives in the Donner Party?</a></li>
<li class="chapter" data-level="" data-path="thursday-november-3-2022.html"><a href="thursday-november-3-2022.html#example-probability-of-rocket-damage-on-liftoff"><i class="fa fa-check"></i>Example: Probability of rocket damage on liftoff</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html"><i class="fa fa-check"></i>Tuesday, November 8, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#today-13"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#quantifying-autocorrelation-in-spatial-data"><i class="fa fa-check"></i>Quantifying autocorrelation in spatial data</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#spatial-data-as-polygons"><i class="fa fa-check"></i>Spatial data as polygons</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#list-of-neighbors"><i class="fa fa-check"></i>List of neighbors</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#spatial-weights-matrix"><i class="fa fa-check"></i>Spatial weights matrix</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#morans-i"><i class="fa fa-check"></i>Moran’s I</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-8-2022.html"><a href="tuesday-november-8-2022.html#spatial-lag-variable"><i class="fa fa-check"></i>Spatial lag variable</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-november-10-2022.html"><a href="thursday-november-10-2022.html"><i class="fa fa-check"></i>Thursday, November 10, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-november-10-2022.html"><a href="thursday-november-10-2022.html#today-14"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-november-10-2022.html"><a href="thursday-november-10-2022.html#statistical-significance-of-spatial-autocorrelation"><i class="fa fa-check"></i>Statistical significance of spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-november-10-2022.html"><a href="thursday-november-10-2022.html#a-monte-carlo-approach-to-inference-about-spatial-autocorrelation"><i class="fa fa-check"></i>A Monte Carlo approach to inference about spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="thursday-november-10-2022.html"><a href="thursday-november-10-2022.html#spatial-autocorrelation-in-model-residuals"><i class="fa fa-check"></i>Spatial autocorrelation in model residuals</a></li>
<li class="chapter" data-level="" data-path="thursday-november-10-2022.html"><a href="thursday-november-10-2022.html#example-percentage-of-folks-identifying-as-white-in-mississippi-counties"><i class="fa fa-check"></i>Example: Percentage of folks identifying as white in Mississippi counties</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html"><i class="fa fa-check"></i>Tuesday, November 15, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html#today-15"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html#bi-variate-spatial-autocorrelation"><i class="fa fa-check"></i>Bi-variate spatial autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html#local-autocorrelation"><i class="fa fa-check"></i>Local autocorrelation</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html#local-regression"><i class="fa fa-check"></i>Local regression</a></li>
<li class="chapter" data-level="" data-path="tuesday-november-15-2022.html"><a href="tuesday-november-15-2022.html#weights-matrix"><i class="fa fa-check"></i>Weights matrix</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html"><i class="fa fa-check"></i>Thursday, November 17, 2022</a>
<ul>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html#today-16"><i class="fa fa-check"></i>Today</a></li>
<li class="chapter" data-level="" data-path="thursday-november-17-2022.html"><a href="thursday-november-17-2022.html#geographic-regression"><i class="fa fa-check"></i>Geographic regression</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEO5156: Quantitative Geography</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tuesday-november-15-2022" class="section level1 unnumbered hasAnchor">
<h1>Tuesday, November 15, 2022<a href="tuesday-november-15-2022.html#tuesday-november-15-2022" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="today-15" class="section level2 unnumbered hasAnchor">
<h2>Today<a href="tuesday-november-15-2022.html#today-15" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>Bivariate spatial autocorrelation</li>
<li>Local spatial autocorrelation</li>
</ul>
<p>Recall the demographic data from the state of Mississippi at the county level. The data are available as ESRI shape files in the folder <em>police</em>. First we import the data to create a simple feature data frame called <code>PE.sf</code>.</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="tuesday-november-15-2022.html#cb987-1" aria-hidden="true" tabindex="-1"></a>PE.sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="at">dsn =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;police&quot;</span>), </span>
<span id="cb987-2"><a href="tuesday-november-15-2022.html#cb987-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">layer =</span> <span class="st">&quot;police&quot;</span>)</span>
<span id="cb987-3"><a href="tuesday-november-15-2022.html#cb987-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb987-4"><a href="tuesday-november-15-2022.html#cb987-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(PE.sf)</span></code></pre></div>
<pre><code>##  [1] &quot;AREA&quot;       &quot;PERIMETER&quot;  &quot;CNTY_&quot;      &quot;CNTY_ID&quot;    &quot;NAME&quot;      
##  [6] &quot;STATE_NAME&quot; &quot;STATE_FIPS&quot; &quot;CNTY_FIPS&quot;  &quot;FIPS&quot;       &quot;FIPSNO&quot;    
## [11] &quot;POLICE&quot;     &quot;POP&quot;        &quot;TAX&quot;        &quot;TRANSFER&quot;   &quot;INC&quot;       
## [16] &quot;CRIME&quot;      &quot;UNEMP&quot;      &quot;OWN&quot;        &quot;COLLEGE&quot;    &quot;WHITE&quot;     
## [21] &quot;COMMUTE&quot;    &quot;geometry&quot;</code></pre>
<p>The simple feature data frame includes police expenditures (<code>POLICE</code>), crime (<code>CRIME</code>), income (<code>INC</code>), unemployment (<code>UNEMP</code>), percentage of people who identify as white (<code>WHITE</code>) among other socioeconomic characteristics in Mississippi by county.</p>
<p>Police expenditures are dollars per person in 1982. The crime variable is the number of serious crimes per 100,000 residents in 1981. The income variable is personal income per county resident in 1982 (dollars per person). The unemployment variable is percent unemployed in 1980.</p>
<p>Because <code>PE.sf</code> is a simple feature data frame it has a column labeled <code>geometry</code>. Here the column contains polygons defining the longitude and latitude coordinates in WKT format that define the county borders.</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="tuesday-november-15-2022.html#cb989-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(PE.sf<span class="sc">$</span>geometry)</span></code></pre></div>
<pre><code>## Geometry set for 6 features 
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -90.30535 ymin: 34.46518 xmax: -88.09043 ymax: 35.00496
## CRS:           NA
## First 5 geometries:</code></pre>
<pre><code>## POLYGON ((-88.35416 34.76262, -88.71059 34.7596...</code></pre>
<pre><code>## POLYGON ((-88.32171 34.4693, -88.3175 34.74454,...</code></pre>
<pre><code>## POLYGON ((-88.72614 34.60488, -89.07788 34.6071...</code></pre>
<pre><code>## POLYGON ((-89.23874 34.59352, -89.29233 34.5927...</code></pre>
<pre><code>## POLYGON ((-90.20186 34.72979, -90.19975 34.8669...</code></pre>
<p>A simple way to display the county borders is to apply the <code>plot()</code> method to the geometry column.</p>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="tuesday-november-15-2022.html#cb996-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(PE.sf<span class="sc">$</span>geometry)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-754-1.png" width="672" /></p>
<p>Recall that to compute spatial autocorrelation you need a spatial weights matrix. The spatial weights matrix includes the set of neighbors and their weights.</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="tuesday-november-15-2022.html#cb997-1" aria-hidden="true" tabindex="-1"></a>nbs <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">poly2nb</span>(PE.sf)</span>
<span id="cb997-2"><a href="tuesday-november-15-2022.html#cb997-2" aria-hidden="true" tabindex="-1"></a>wts <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nbs)</span></code></pre></div>
<p>You then apply the <code>moran.test()</code> function. Here we apply the function to the variable labeled <code>WHITE</code>.</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="tuesday-november-15-2022.html#cb998-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran.test</span>(PE.sf<span class="sc">$</span>WHITE, </span>
<span id="cb998-2"><a href="tuesday-november-15-2022.html#cb998-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">listw =</span> wts)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  PE.sf$WHITE  
## weights: wts    
## 
## Moran I statistic standard deviate = 8.5089, p-value &lt; 2.2e-16
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.563477779      -0.012345679       0.004579648</code></pre>
<p>The Moran I statistic is .56 and it is statistically significant indicating counties that are predominantly white tend to be surrounded by counties that are also predominately white.</p>
</div>
<div id="bi-variate-spatial-autocorrelation" class="section level2 unnumbered hasAnchor">
<h2>Bi-variate spatial autocorrelation<a href="tuesday-november-15-2022.html#bi-variate-spatial-autocorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Spatial autocorrelation can be extended to two variables. The extension is motivated by the fact that association measures, like Pearson’s correlation coefficient, do not recognize the spatial arrangement of the data values.</p>
<p>Consider for example the correlation between police expenditure (<code>POLICE</code>) and the amount of crime (<code>CRIME</code>) in the police expenditure data set.</p>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="tuesday-november-15-2022.html#cb1000-1" aria-hidden="true" tabindex="-1"></a>police <span class="ot">&lt;-</span> PE.sf<span class="sc">$</span>POLICE</span>
<span id="cb1000-2"><a href="tuesday-november-15-2022.html#cb1000-2" aria-hidden="true" tabindex="-1"></a>crime <span class="ot">&lt;-</span> PE.sf<span class="sc">$</span>CRIME</span>
<span id="cb1000-3"><a href="tuesday-november-15-2022.html#cb1000-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1000-4"><a href="tuesday-november-15-2022.html#cb1000-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(police, crime)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  police and crime
## t = 6.2916, df = 80, p-value = 1.569e-08
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.4094516 0.7043990
## sample estimates:
##       cor 
## 0.5753377</code></pre>
<p>You find a significant correlation (<span class="math inline">\(p\)</span> value &lt; .01) between these two variables under the null hypothesis that they are uncorrelated. The significance level assumes that the values of police expenditure and crime in one county is independent of the values of expenditure and crime in a neighboring county.</p>
<p>You note, however, that these variables have significant spatial autocorrelation.</p>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="tuesday-november-15-2022.html#cb1002-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran.test</span>(police, <span class="at">listw =</span> wts)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  police  
## weights: wts    
## 
## Moran I statistic standard deviate = 1.7899, p-value = 0.03674
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.087185424      -0.012345679       0.003092257</code></pre>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="tuesday-november-15-2022.html#cb1004-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">moran.test</span>(crime, <span class="at">listw =</span> wts)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  crime  
## weights: wts    
## 
## Moran I statistic standard deviate = 2.2072, p-value = 0.01365
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.103588680      -0.012345679       0.002758842</code></pre>
<p>The spatial autocorrelation indicates that the counties cannot be treated as independent.</p>
<p>In addition there can be <em>indirect</em> correlation, where the amount of police spending in a particular county is correlated with the level of crime in neighboring counties.</p>
<p>The Lee statistic brings together Pearson’s r statistic and Moran’s I. The formula is
<span class="math display">\[
L(x,y) = \frac{n}{\sum_{i=1}^{n}(\sum_{j=1}^{n}w_{ij})^2}
\frac{\sum_{i=1}^{n}(\sum_{j=1}^{n}w_{ij}(x_i-\bar{x})) ((\sum_{j=1}^{n}w_{ij}(y_j-\bar{y}))}{\sqrt{\sum_{i=1}^{n}(x_i - \bar{x})^2} \sqrt{\sum_{i=1}^{n}(y_i - \bar{y})^2}}
\]</span>
For the crime example, you let <span class="math inline">\(x\)</span> be crime rates and <span class="math inline">\(y\)</span> be police spending.</p>
<p>The formula is applied with the <code>lee()</code> function where the first two arguments are the variables and you need to include the weights matrix with the <code>listw =</code> argument and the number of regions with the <code>n =</code> argument. The output from this function is a list of two with the first being the value of Lee’s statistic (<code>L</code>).</p>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="tuesday-november-15-2022.html#cb1006-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">lee</span>(<span class="at">x =</span> crime, </span>
<span id="cb1006-2"><a href="tuesday-november-15-2022.html#cb1006-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> police, </span>
<span id="cb1006-3"><a href="tuesday-november-15-2022.html#cb1006-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw =</span> wts, </span>
<span id="cb1006-4"><a href="tuesday-november-15-2022.html#cb1006-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">n =</span> <span class="fu">length</span>(nbs))<span class="sc">$</span>L</span></code></pre></div>
<pre><code>## [1] 0.1306991</code></pre>
<p>Values of the Lee statistic can range between -1 and +1 with the value of .13 here indicating weak bi-variate spatial autocorrelation between crime and police expenditures. You state that police spending has some weak correlation with crime in neighboring counties, but not much.</p>
<p>You note that neither values in <code>crime</code> nor values in <code>police</code> are adequately described by a normal distribution.</p>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="tuesday-november-15-2022.html#cb1008-1" aria-hidden="true" tabindex="-1"></a>sm<span class="sc">::</span><span class="fu">sm.density</span>(crime, <span class="at">model =</span> <span class="st">&quot;normal&quot;</span>)</span>
<span id="cb1008-2"><a href="tuesday-november-15-2022.html#cb1008-2" aria-hidden="true" tabindex="-1"></a>sm<span class="sc">::</span><span class="fu">sm.density</span>(police, <span class="at">model =</span> <span class="st">&quot;normal&quot;</span>)</span></code></pre></div>
<p>So you use a non-parametric (Monte Carlo) test for significance on the bivariate spatial autocorrelation with the <code>lee.mc()</code> function.</p>
<p>The crime and police expenditure values are randomly permuted across the counties and values of <code>L</code> are computed for each permutation. Here we set the number of permutations to 999 with the <code>nsim =</code> argument.</p>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="tuesday-november-15-2022.html#cb1009-1" aria-hidden="true" tabindex="-1"></a>spdep<span class="sc">::</span><span class="fu">lee.mc</span>(<span class="at">x =</span> crime, </span>
<span id="cb1009-2"><a href="tuesday-november-15-2022.html#cb1009-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">y =</span> police, </span>
<span id="cb1009-3"><a href="tuesday-november-15-2022.html#cb1009-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">listw =</span> wts, </span>
<span id="cb1009-4"><a href="tuesday-november-15-2022.html#cb1009-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">nsim =</span> <span class="dv">999</span>)</span></code></pre></div>
<pre><code>## 
##  Monte-Carlo simulation of Lee&#39;s L
## 
## data:  crime ,  police 
## weights: wts  
## number of simulations + 1: 1000 
## 
## statistic = 0.1307, observed rank = 758, p-value = 0.242
## alternative hypothesis: greater</code></pre>
<p>From the test results you conclude that there is no significant bi-variate spatial autocorrelation between crime and police expenditure. Police expenditure in a county is not significantly influenced by crime in neighboring counties.</p>
</div>
<div id="local-autocorrelation" class="section level2 unnumbered hasAnchor">
<h2>Local autocorrelation<a href="tuesday-november-15-2022.html#local-autocorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Moran I statistic was first used in the 1950s. A local version of the statistic was introduced in the 1990s.</p>
<p>Local I is a deconstruction of the ‘global’ Moran’s I, where geographic proximity is used in two ways. (1) to define and weight neighbors and (2) to determine the spatial scale over which Moran’s I is computed.</p>
<p>For example, consider the tenth county in the police expenditure data frame.</p>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1011-1"><a href="tuesday-november-15-2022.html#cb1011-1" aria-hidden="true" tabindex="-1"></a>PE.sf[<span class="dv">10</span>, ]</span></code></pre></div>
<pre><code>## Simple feature collection with 1 feature and 21 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -89.24072 ymin: 34.37103 xmax: -88.72366 ymax: 34.60714
## CRS:           NA
## # A tibble: 1 × 22
##    AREA PERIME…¹ CNTY_ CNTY_ID NAME  STATE…² STATE…³ CNTY_…⁴ FIPS  FIPSNO POLICE
##   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;int&gt;
## 1 0.109     1.49  2199    2199 Union Missis… 28      145     28145  28145    364
## # … with 11 more variables: POP &lt;int&gt;, TAX &lt;int&gt;, TRANSFER &lt;int&gt;, INC &lt;int&gt;,
## #   CRIME &lt;int&gt;, UNEMP &lt;int&gt;, OWN &lt;int&gt;, COLLEGE &lt;int&gt;, WHITE &lt;int&gt;,
## #   COMMUTE &lt;int&gt;, geometry &lt;POLYGON&gt;, and abbreviated variable names
## #   ¹​PERIMETER, ²​STATE_NAME, ³​STATE_FIPS, ⁴​CNTY_FIPS
## # ℹ Use `colnames()` to see all variable names</code></pre>
<p>It is Union County with a population of 21,400 residents of which 86% identify as white.</p>
<p>Union County has 7 neighbors as defined by contiguity. The neighbors are</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="tuesday-november-15-2022.html#cb1013-1" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>NAME[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])]</span></code></pre></div>
<pre><code>## [1] &quot;Tippah&quot;    &quot;Benton&quot;    &quot;Marshall&quot;  &quot;Prentiss&quot;  &quot;Lafayette&quot; &quot;Lee&quot;      
## [7] &quot;Pontotoc&quot;</code></pre>
<p>On a map you color Union County red and its neighboring counties pink.</p>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="tuesday-november-15-2022.html#cb1015-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(PE.sf<span class="sc">$</span>geometry)</span>
<span id="cb1015-2"><a href="tuesday-november-15-2022.html#cb1015-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(PE.sf<span class="sc">$</span>geometry[<span class="dv">10</span>], <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb1015-3"><a href="tuesday-november-15-2022.html#cb1015-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(PE.sf<span class="sc">$</span>geometry[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])], <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-764-1.png" width="672" /></p>
<p>The neighborhood average percent white is computed as</p>
<div class="sourceCode" id="cb1016"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1016-1"><a href="tuesday-november-15-2022.html#cb1016-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(PE.sf<span class="sc">$</span>WHITE[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])])</span></code></pre></div>
<pre><code>## [1] 74</code></pre>
<p>The neighbor average percentage of whites is lower than the percentage of whites in Union County. This two dimensional point (86, 74) contributes to the global Moran’s I, but it also contributes to the local Moran’s I if we consider only these 8 counties.</p>
<p>For example, consider the first neighbor of Union County.</p>
<div class="sourceCode" id="cb1018"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1018-1"><a href="tuesday-november-15-2022.html#cb1018-1" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>NAME[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] &quot;Tippah&quot;</code></pre>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="tuesday-november-15-2022.html#cb1020-1" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>WHITE[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] 84</code></pre>
<p>Tippah County, MS where according to the data set 84% of its residents identifying as white.</p>
<p>Tippah County has 4 neighbors. They are</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="tuesday-november-15-2022.html#cb1022-1" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>NAME[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])[<span class="dv">1</span>]])]</span></code></pre></div>
<pre><code>## [1] &quot;Alcorn&quot;   &quot;Benton&quot;   &quot;Prentiss&quot; &quot;Union&quot;</code></pre>
<p>On a map</p>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="tuesday-november-15-2022.html#cb1024-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(PE.sf<span class="sc">$</span>geometry)</span>
<span id="cb1024-2"><a href="tuesday-november-15-2022.html#cb1024-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(PE.sf<span class="sc">$</span>geometry[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])[<span class="dv">1</span>]], </span>
<span id="cb1024-3"><a href="tuesday-november-15-2022.html#cb1024-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;pink&quot;</span>)</span>
<span id="cb1024-4"><a href="tuesday-november-15-2022.html#cb1024-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(PE.sf<span class="sc">$</span>geometry[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])[<span class="dv">1</span>]])], </span>
<span id="cb1024-5"><a href="tuesday-november-15-2022.html#cb1024-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-768-1.png" width="672" /></p>
<p>The neighborhood average percent of whites in Tippah County is computed as</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="tuesday-november-15-2022.html#cb1025-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(PE.sf<span class="sc">$</span>WHITE[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])[<span class="dv">1</span>]])])</span></code></pre></div>
<pre><code>## [1] 81.5</code></pre>
<p>This gives you a new point (84, 81.5).</p>
<p>Continuing this for all of the 7 contiguous neighbors of Union County plus Union County itself gives you 8 points on a local Moran’s scatter plot.</p>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="tuesday-november-15-2022.html#cb1027-1" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> PE.sf<span class="sc">$</span>WHITE</span>
<span id="cb1027-2"><a href="tuesday-november-15-2022.html#cb1027-2" aria-hidden="true" tabindex="-1"></a>Wlag <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">lag.listw</span>(wts, </span>
<span id="cb1027-3"><a href="tuesday-november-15-2022.html#cb1027-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">var =</span> W)</span>
<span id="cb1027-4"><a href="tuesday-november-15-2022.html#cb1027-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-5"><a href="tuesday-november-15-2022.html#cb1027-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1027-6"><a href="tuesday-november-15-2022.html#cb1027-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">W =</span> <span class="fu">c</span>(W[<span class="dv">10</span>], W[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])]),</span>
<span id="cb1027-7"><a href="tuesday-november-15-2022.html#cb1027-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">Wlag =</span> <span class="fu">c</span>(Wlag[<span class="dv">10</span>], Wlag[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])]),</span>
<span id="cb1027-8"><a href="tuesday-november-15-2022.html#cb1027-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">Name =</span> <span class="fu">c</span>(PE.sf<span class="sc">$</span>NAME[<span class="dv">10</span>], PE.sf<span class="sc">$</span>NAME[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])])) <span class="sc">|&gt;</span></span>
<span id="cb1027-9"><a href="tuesday-november-15-2022.html#cb1027-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> W, <span class="at">y =</span> Wlag, <span class="at">label =</span> Name)) <span class="sc">+</span></span>
<span id="cb1027-10"><a href="tuesday-november-15-2022.html#cb1027-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1027-11"><a href="tuesday-november-15-2022.html#cb1027-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">&quot;pink3&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-12"><a href="tuesday-november-15-2022.html#cb1027-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">nudge_y =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;pink3&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-13"><a href="tuesday-november-15-2022.html#cb1027-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> W[<span class="dv">1</span>], <span class="at">y =</span> Wlag[<span class="dv">1</span>]), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-14"><a href="tuesday-november-15-2022.html#cb1027-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> W[<span class="dv">1</span>], <span class="at">y =</span> Wlag[<span class="dv">1</span>], <span class="at">label =</span> Name[<span class="dv">1</span>]), <span class="at">nudge_y =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-15"><a href="tuesday-november-15-2022.html#cb1027-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Average percent white in neighboring counties&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-16"><a href="tuesday-november-15-2022.html#cb1027-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Percent white&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-17"><a href="tuesday-november-15-2022.html#cb1027-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1027-18"><a href="tuesday-november-15-2022.html#cb1027-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">&quot;Union County&quot;</span>,</span>
<span id="cb1027-19"><a href="tuesday-november-15-2022.html#cb1027-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="st">&quot;Moran&#39;s scatter plot of percent white&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-770-1.png" width="672" /></p>
<p>This is the local Moran’s scatter plot for Union County. In the same way, you can draw a local Moran scatter plot for each county.</p>
<p>Here for Clarke County.</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="tuesday-november-15-2022.html#cb1029-1" aria-hidden="true" tabindex="-1"></a>county <span class="ot">&lt;-</span> <span class="dv">54</span></span>
<span id="cb1029-2"><a href="tuesday-november-15-2022.html#cb1029-2" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>NAME[county]</span></code></pre></div>
<pre><code>## [1] &quot;Clarke&quot;</code></pre>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="tuesday-november-15-2022.html#cb1031-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">W =</span> <span class="fu">c</span>(W[county], W[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[county])]),</span>
<span id="cb1031-2"><a href="tuesday-november-15-2022.html#cb1031-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">Wlag =</span> <span class="fu">c</span>(Wlag[county], Wlag[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[county])]),</span>
<span id="cb1031-3"><a href="tuesday-november-15-2022.html#cb1031-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">Name =</span> <span class="fu">c</span>(PE.sf<span class="sc">$</span>NAME[county], PE.sf<span class="sc">$</span>NAME[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[county])])) <span class="sc">|&gt;</span></span>
<span id="cb1031-4"><a href="tuesday-november-15-2022.html#cb1031-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> W, <span class="at">y =</span> Wlag, <span class="at">label =</span> Name)) <span class="sc">+</span></span>
<span id="cb1031-5"><a href="tuesday-november-15-2022.html#cb1031-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1031-6"><a href="tuesday-november-15-2022.html#cb1031-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">col =</span> <span class="st">&quot;pink3&quot;</span>) <span class="sc">+</span></span>
<span id="cb1031-7"><a href="tuesday-november-15-2022.html#cb1031-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">nudge_y =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;pink3&quot;</span>) <span class="sc">+</span></span>
<span id="cb1031-8"><a href="tuesday-november-15-2022.html#cb1031-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> W[<span class="dv">1</span>], <span class="at">y =</span> Wlag[<span class="dv">1</span>]), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1031-9"><a href="tuesday-november-15-2022.html#cb1031-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> W[<span class="dv">1</span>], <span class="at">y =</span> Wlag[<span class="dv">1</span>], <span class="at">label =</span> Name[<span class="dv">1</span>]), <span class="at">nudge_y =</span> .<span class="dv">5</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb1031-10"><a href="tuesday-november-15-2022.html#cb1031-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Average percent white in neighboring counties&quot;</span>) <span class="sc">+</span></span>
<span id="cb1031-11"><a href="tuesday-november-15-2022.html#cb1031-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Percent white&quot;</span>) <span class="sc">+</span></span>
<span id="cb1031-12"><a href="tuesday-november-15-2022.html#cb1031-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1031-13"><a href="tuesday-november-15-2022.html#cb1031-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">&quot;Clarke County&quot;</span>,</span>
<span id="cb1031-14"><a href="tuesday-november-15-2022.html#cb1031-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="st">&quot;Moran&#39;s scatter plot of percent white&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-771-1.png" width="672" /></p>
<p>Clark County’s four neighbors are Jasper, Wayne, Newton, and Lauderdale and the relationship is opposite to that of Union County. Here you see that counties with a relatively high percentage of whites neighbors to counties with a relatively low percentage of whites.</p>
<p>The slope of the regression line is the local Moran’s I value. It can be computed for Union and Clarke counties as</p>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="tuesday-november-15-2022.html#cb1033-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(<span class="fu">c</span>(Wlag[<span class="dv">10</span>], Wlag[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])]) <span class="sc">~</span> <span class="fu">c</span>(W[<span class="dv">10</span>], W[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">10</span>])])))[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## c(W[10], W[unlist(wts$neighbours[10])]) 
##                               0.2508013</code></pre>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="tuesday-november-15-2022.html#cb1035-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(<span class="fu">c</span>(Wlag[<span class="dv">54</span>], Wlag[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">54</span>])]) <span class="sc">~</span> <span class="fu">c</span>(W[<span class="dv">54</span>], W[<span class="fu">unlist</span>(wts<span class="sc">$</span>neighbours[<span class="dv">54</span>])])))[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>## c(W[54], W[unlist(wts$neighbours[54])]) 
##                              -0.3683312</code></pre>
<p>In practice you compute local Moran I with the <code>localmoran()</code> function from the {spdep} package. The two required arguments are the variable for which you want to compute local correlation and the weights matrix as a list object.</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="tuesday-november-15-2022.html#cb1037-1" aria-hidden="true" tabindex="-1"></a>Ii_stats <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">localmoran</span>(PE.sf<span class="sc">$</span>WHITE, </span>
<span id="cb1037-2"><a href="tuesday-november-15-2022.html#cb1037-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">listw =</span> wts)</span>
<span id="cb1037-3"><a href="tuesday-november-15-2022.html#cb1037-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Ii_stats)</span></code></pre></div>
<pre><code>##  &#39;localmoran&#39; num [1:82, 1:5] 2.28138 2.97475 1.31244 0.00231 -1.03216 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : chr [1:82] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; ...
##   ..$ : chr [1:5] &quot;Ii&quot; &quot;E.Ii&quot; &quot;Var.Ii&quot; &quot;Z.Ii&quot; ...
##  - attr(*, &quot;call&quot;)= language spdep::localmoran(x = PE.sf$WHITE, listw = wts)
##  - attr(*, &quot;quadr&quot;)=&#39;data.frame&#39;:    82 obs. of  3 variables:
##   ..$ mean  : Factor w/ 4 levels &quot;Low-Low&quot;,&quot;High-Low&quot;,..: 4 4 4 4 2 3 1 1 4 4 ...
##   ..$ median: Factor w/ 4 levels &quot;Low-Low&quot;,&quot;High-Low&quot;,..: 4 4 4 3 2 3 1 1 4 4 ...
##   ..$ pysal : Factor w/ 4 levels &quot;Low-Low&quot;,&quot;High-Low&quot;,..: 4 4 4 4 2 3 1 1 4 4 ...</code></pre>
<p>The local I is given in the first column of a matrix where the rows are the counties. The other columns are the expected value of I, the variance of I, the <span class="math inline">\(z\)</span>-value and the <span class="math inline">\(p\)</span> value. For example, the local I statistics from the first six counties are given by typing</p>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="tuesday-november-15-2022.html#cb1039-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Ii_stats)</span></code></pre></div>
<pre><code>##             Ii          E.Ii       Var.Ii      Z.Ii Pr(z != E(Ii))
## 1  2.281375143 -2.748824e-02 7.124247e-01  2.735450    0.006229509
## 2  2.974750377 -4.354053e-02 1.109833e+00  2.865051    0.004169423
## 3  1.312440365 -1.827251e-02 3.539514e-01  2.236725    0.025304339
## 4  0.002313108 -2.007906e-07 5.351069e-06  1.000031    0.317295645
## 5 -1.032155817 -1.511126e-02 3.966295e-01 -1.614907    0.106330864
## 6 -0.493034653 -8.356103e-03 1.291002e-01 -1.348933    0.177358557</code></pre>
<p>Because these local values must average to the global value (when using row standardized weights), they can take on values outside the range between -1 and 1. A <code>summary()</code> method on the first column of the <code>Li</code> object gives statistics from the distribution of I’s.</p>
<div class="sourceCode" id="cb1041"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1041-1"><a href="tuesday-november-15-2022.html#cb1041-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Ii_stats[, <span class="dv">1</span>])</span></code></pre></div>
<pre><code>##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## -1.03216  0.01733  0.26984  0.56348  1.05945  2.97475</code></pre>
<p>The mean value over all counties is the global Moran I (.56).</p>
<p>To map the values you first attach the matrix columns of interest to the simple feature data frame. Here you attach <code>Ii</code>, <code>Var</code>, and <code>Pi</code>.</p>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1043-1"><a href="tuesday-november-15-2022.html#cb1043-1" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>Ii <span class="ot">&lt;-</span> Ii_stats[, <span class="dv">1</span>]</span>
<span id="cb1043-2"><a href="tuesday-november-15-2022.html#cb1043-2" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>Vi <span class="ot">&lt;-</span> Ii_stats[, <span class="dv">3</span>]</span>
<span id="cb1043-3"><a href="tuesday-november-15-2022.html#cb1043-3" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>Pi <span class="ot">&lt;-</span> Ii_stats[, <span class="dv">5</span>]</span></code></pre></div>
<p>Then you map the local spatial autocorrelation.</p>
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="tuesday-november-15-2022.html#cb1044-1" aria-hidden="true" tabindex="-1"></a>( g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> PE.sf) <span class="sc">+</span></span>
<span id="cb1044-2"><a href="tuesday-november-15-2022.html#cb1044-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Ii)) <span class="sc">+</span></span>
<span id="cb1044-3"><a href="tuesday-november-15-2022.html#cb1044-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb1044-4"><a href="tuesday-november-15-2022.html#cb1044-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">high =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1044-5"><a href="tuesday-november-15-2022.html#cb1044-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() )</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-777-1.png" width="672" /></p>
<p>The map shows three areas (clusters) of relatively high positive local spatial autocorrelation across the state; the northeast, the west, and the south. A few counties in the north have negative local spatial autocorrelation.</p>
<p>To make greater sense of these so-called ‘clusters’ you plot the map of local autocorrelation alongside a map of the percentage of whites.</p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="tuesday-november-15-2022.html#cb1045-1" aria-hidden="true" tabindex="-1"></a>( g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> PE.sf) <span class="sc">+</span></span>
<span id="cb1045-2"><a href="tuesday-november-15-2022.html#cb1045-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> WHITE)) <span class="sc">+</span></span>
<span id="cb1045-3"><a href="tuesday-november-15-2022.html#cb1045-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;brown&quot;</span>,</span>
<span id="cb1045-4"><a href="tuesday-november-15-2022.html#cb1045-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb1045-5"><a href="tuesday-november-15-2022.html#cb1045-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() )</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-778-1.png" width="672" /></p>
<p>Plot them together using syntax from the {patchwork} package.</p>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1046-1"><a href="tuesday-november-15-2022.html#cb1046-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1046-2"><a href="tuesday-november-15-2022.html#cb1046-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1046-3"><a href="tuesday-november-15-2022.html#cb1046-3" aria-hidden="true" tabindex="-1"></a>g1 <span class="sc">+</span> g2</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-779-1.png" width="672" /></p>
<p>Areas of the state where percent white values are high, like over the northeast, are areas where there is high spatial autocorrelation. Also areas of the Mississippi delta region in the west, where percent white values are low, are areas where there is high spatial autocorrelation.</p>
<p>The <span class="math inline">\(p\)</span> values on the local autocorrelation values highlight the three clusters.</p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="tuesday-november-15-2022.html#cb1047-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> PE.sf) <span class="sc">+</span></span>
<span id="cb1047-2"><a href="tuesday-november-15-2022.html#cb1047-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Pi)) <span class="sc">+</span></span>
<span id="cb1047-3"><a href="tuesday-november-15-2022.html#cb1047-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>() <span class="sc">+</span></span>
<span id="cb1047-4"><a href="tuesday-november-15-2022.html#cb1047-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-780-1.png" width="672" /></p>
<p>Finally, variances are larger for counties near the boundaries as the sample sizes are smaller.</p>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1048-1"><a href="tuesday-november-15-2022.html#cb1048-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> PE.sf) <span class="sc">+</span></span>
<span id="cb1048-2"><a href="tuesday-november-15-2022.html#cb1048-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> Vi)) <span class="sc">+</span></span>
<span id="cb1048-3"><a href="tuesday-november-15-2022.html#cb1048-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>() <span class="sc">+</span></span>
<span id="cb1048-4"><a href="tuesday-november-15-2022.html#cb1048-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-781-1.png" width="672" /></p>
<p>Local values of Lee’s bi-variate spatial autocorrelation are available from the <code>lee()</code> function.</p>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="tuesday-november-15-2022.html#cb1049-1" aria-hidden="true" tabindex="-1"></a>lee_stat <span class="ot">&lt;-</span> spdep<span class="sc">::</span><span class="fu">lee</span>(crime, police, </span>
<span id="cb1049-2"><a href="tuesday-november-15-2022.html#cb1049-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">listw =</span> wts, </span>
<span id="cb1049-3"><a href="tuesday-november-15-2022.html#cb1049-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n =</span> <span class="fu">length</span>(nbs))</span>
<span id="cb1049-4"><a href="tuesday-november-15-2022.html#cb1049-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-5"><a href="tuesday-november-15-2022.html#cb1049-5" aria-hidden="true" tabindex="-1"></a>PE.sf<span class="sc">$</span>localL <span class="ot">&lt;-</span> lee_stat<span class="sc">$</span>localL</span>
<span id="cb1049-6"><a href="tuesday-november-15-2022.html#cb1049-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-7"><a href="tuesday-november-15-2022.html#cb1049-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1049-8"><a href="tuesday-november-15-2022.html#cb1049-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1049-9"><a href="tuesday-november-15-2022.html#cb1049-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(PE.sf) <span class="sc">+</span></span>
<span id="cb1049-10"><a href="tuesday-november-15-2022.html#cb1049-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_fill</span>(<span class="st">&quot;localL&quot;</span>,</span>
<span id="cb1049-11"><a href="tuesday-november-15-2022.html#cb1049-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">title =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb1049-12"><a href="tuesday-november-15-2022.html#cb1049-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_borders</span>(<span class="at">col =</span> <span class="st">&quot;gray70&quot;</span>) <span class="sc">+</span></span>
<span id="cb1049-13"><a href="tuesday-november-15-2022.html#cb1049-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Local Bi-variate Spatial Autocorrelation&quot;</span>,</span>
<span id="cb1049-14"><a href="tuesday-november-15-2022.html#cb1049-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning: Currect projection of shape PE.sf unknown. Long-lat (WGS84) is assumed.</code></pre>
<pre><code>## Variable(s) &quot;localL&quot; contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-782-1.png" width="672" /></p>
<p>Areas in dark green indicate where the correlation between crime and policing is most influenced by neighboring crime and policing.</p>
</div>
<div id="local-regression" class="section level2 unnumbered hasAnchor">
<h2>Local regression<a href="tuesday-november-15-2022.html#local-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When you fit a regression model to your data you get a single set of coefficients that quantifies the relationship between the response variable and the explanatory variables. When you fit a geographic regression model to your data yet get an entire set of coefficients, one for every location.</p>
<p>Geographic regression shows where the response variable is most strongly related to the explanatory variables.</p>
<p>Geographic regression is similar to local regression. For example, compare a regression of ozone on temperature (‘global’ regression) with a ‘local’ regression of ozone on temperature.</p>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1052-1"><a href="tuesday-november-15-2022.html#cb1052-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> airquality, </span>
<span id="cb1052-2"><a href="tuesday-november-15-2022.html#cb1052-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Temp, <span class="at">y =</span> Ozone)) <span class="sc">+</span></span>
<span id="cb1052-3"><a href="tuesday-november-15-2022.html#cb1052-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb1052-4"><a href="tuesday-november-15-2022.html#cb1052-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1052-5"><a href="tuesday-november-15-2022.html#cb1052-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> lm, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 37 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 37 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 37 rows containing missing values (geom_point).</code></pre>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-783-1.png" width="672" /></p>
<p>Global regression is represented by the red line. Local regression is represented by the blue curve. Global regression over estimates the relationship at low temperature (the red line has a steeper slope compared to the blue line for temperatures less than 75F) and it under estimates the relationship at high temperature (the red line has a shallower slope compared to the blue line for temperatures above 75F). Note: It is the relationship we are describing not the observations.</p>
<p>The red line has a single value for the slope and a single value for the intercept across all values of temperature. You can get these two values with the <code>lm()</code> function. The local regression has a slope and intercept at each observation.</p>
<p>This is done by weighting the observations based on ‘distance’ to <code>Temp = 70</code>. Observations with temperature near 70F are given more weight than those much warmer and those much colder.</p>
<p>The change in ozone per degree change in temperature is small for temperatures less than 75F, but this change increases as temperatures rise through the 80’s.</p>
</div>
<div id="weights-matrix" class="section level2 unnumbered hasAnchor">
<h2>Weights matrix<a href="tuesday-november-15-2022.html#weights-matrix" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This ‘inverse-distance’ weighting (more weight to nearby observations) is applied to each observation and the weights are stored in matrix (W). Elements of the weights matrix W are labeled <span class="math inline">\(w_{ij}\)</span>, where <span class="math inline">\(i\)</span> indexes the location and <span class="math inline">\(j\)</span> indexes all other values. The precise values in W are determined by a function called a kernel.</p>
<p>The kernel describes how much weight to give each observation based on how far the observation is from the location of interest. The kernel is symmetric about the location of interest and often takes the form of a gaussian curve.</p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="tuesday-november-15-2022.html#cb1058-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)), <span class="fu">aes</span>(x)) <span class="sc">+</span> </span>
<span id="cb1058-2"><a href="tuesday-november-15-2022.html#cb1058-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x) <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>), <span class="at">lwd =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1058-3"><a href="tuesday-november-15-2022.html#cb1058-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;spatial distance&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1058-4"><a href="tuesday-november-15-2022.html#cb1058-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;weight&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb1058-5"><a href="tuesday-november-15-2022.html#cb1058-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">&quot;kernel centered at location 0&quot;</span>)</span>
<span id="cb1058-6"><a href="tuesday-november-15-2022.html#cb1058-6" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-784-1.png" width="672" /></p>
<p>Local feature distance is the horizontal axis and the amount of weight is the vertical axis.</p>
<p>The kernel is centered on the location of interest. Here at 0 distance.</p>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="tuesday-november-15-2022.html#cb1059-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb1059-2"><a href="tuesday-november-15-2022.html#cb1059-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="sc">-</span>.<span class="dv">02</span>, <span class="at">label =</span> <span class="st">&quot;x1&quot;</span>))</span>
<span id="cb1059-3"><a href="tuesday-november-15-2022.html#cb1059-3" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-785-1.png" width="672" /></p>
<p>Data values at that location get the most weight indicated by the height of the kernel above that location.</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="tuesday-november-15-2022.html#cb1060-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5</span> <span class="sc">*</span> <span class="dv">0</span><span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb1060-2"><a href="tuesday-november-15-2022.html#cb1060-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yend =</span> <span class="dv">0</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">0</span>), </span>
<span id="cb1060-3"><a href="tuesday-november-15-2022.html#cb1060-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1060-4"><a href="tuesday-november-15-2022.html#cb1060-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> .<span class="dv">3</span>, <span class="at">y =</span> .<span class="dv">2</span>, <span class="at">label =</span> <span class="st">&quot;w11&quot;</span>))</span>
<span id="cb1060-5"><a href="tuesday-november-15-2022.html#cb1060-5" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-786-1.png" width="672" /></p>
<p>Data values at neighboring locations get less weight. For example, the second data value at location x2 we have a weight w12. The first index indicates the kernel centered on observation 1, and the second index is location of observation 2.</p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="tuesday-november-15-2022.html#cb1061-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb1061-2"><a href="tuesday-november-15-2022.html#cb1061-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="sc">-</span>.<span class="dv">02</span>, <span class="at">label =</span> <span class="st">&quot;x2&quot;</span>))</span>
<span id="cb1061-3"><a href="tuesday-november-15-2022.html#cb1061-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1061-4"><a href="tuesday-november-15-2022.html#cb1061-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb1061-5"><a href="tuesday-november-15-2022.html#cb1061-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yend =</span> <span class="dv">0</span>, <span class="at">x =</span> <span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">1</span>), </span>
<span id="cb1061-6"><a href="tuesday-november-15-2022.html#cb1061-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1061-7"><a href="tuesday-november-15-2022.html#cb1061-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> .<span class="dv">7</span>, <span class="at">y =</span> .<span class="dv">1</span>, <span class="at">label =</span> <span class="st">&quot;w12&quot;</span>))</span>
<span id="cb1061-8"><a href="tuesday-november-15-2022.html#cb1061-8" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-787-1.png" width="672" /></p>
<p>Similarly, at the third data value at location x3 we have a weight w13.</p>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="tuesday-november-15-2022.html#cb1062-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">y =</span> <span class="dv">0</span>), <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb1062-2"><a href="tuesday-november-15-2022.html#cb1062-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">y =</span> <span class="sc">-</span>.<span class="dv">02</span>, <span class="at">label =</span> <span class="st">&quot;x3&quot;</span>))</span>
<span id="cb1062-3"><a href="tuesday-november-15-2022.html#cb1062-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>.<span class="dv">5</span> <span class="sc">*</span> (<span class="sc">-</span><span class="dv">2</span>)<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb1062-4"><a href="tuesday-november-15-2022.html#cb1062-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">yend =</span> <span class="dv">0</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="dv">2</span>), </span>
<span id="cb1062-5"><a href="tuesday-november-15-2022.html#cb1062-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1062-6"><a href="tuesday-november-15-2022.html#cb1062-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="fl">1.7</span>, <span class="at">y =</span> .<span class="dv">025</span>, <span class="at">label =</span> <span class="st">&quot;w13&quot;</span>))</span>
<span id="cb1062-7"><a href="tuesday-november-15-2022.html#cb1062-7" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-788-1.png" width="672" /></p>
<p>Other kernel shapes are possible, but they all tend to be symmetric reflecting the type of dependency found in most spatial processes.</p>
<p>At each location <span class="math inline">\(i\)</span> for which the local regression model is estimated, the kernel is given by
<span class="math display">\[
w_{ij} = \left[-(d_{ij}/h)^2\right],
\]</span>
where <span class="math inline">\(d_{ij}\)</span> is the distance between locations <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, and <span class="math inline">\(h\)</span> is the bandwidth. As <span class="math inline">\(h\)</span> increases, the gradient of the kernel becomes less steep and more data points are included in the local estimation.</p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="tuesday-november-15-2022.html#cb1063-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">y =</span> .<span class="dv">23</span>, <span class="at">yend =</span> .<span class="dv">23</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">xend =</span> <span class="dv">1</span>), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb1063-2"><a href="tuesday-november-15-2022.html#cb1063-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">25</span>, <span class="at">label =</span> <span class="st">&quot;bandwidth&quot;</span>)</span></code></pre></div>
<p><img src="QG-2022_files/figure-html/unnamed-chunk-789-1.png" width="672" /></p>
<p>The choice of bandwidth is a trade-off between variance and bias. A bandwidth that is narrow results in large variation in model coefficients across the domain. A bandwidth that is wide leads to a large bias locally as the model coefficients are influenced by processes not representative of the local conditions.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="thursday-november-10-2022.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="thursday-november-17-2022.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
